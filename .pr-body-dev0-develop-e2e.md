## Summary

This PR hardens our auth + navigation flows with new Playwright E2E coverage and fixes the env-loader precedence for local test credentials:

- Adds logout-flow coverage so we don’t regress the post-logout nav bug again.
- Adds a marketing auth-handoff test to verify the D+E+F behavior on jobhackai.io.
- Adds a small real-API smoke suite for core plan/billing endpoints.
- Adds dedicated account-settings tests and an error-handling smoke for /api/plan/me failures.
- Fixes the order we load .env vs .env.test.local so local overrides actually win.

## Changes

### 1. Authentication & protected-route E2Es

**Files:**
- app/tests/e2e/auth.spec.js

**What:**
- Import waitForAuthReady from auth-helpers.
- Logout flow test `logout clears auth state and shows visitor nav`:
  - Navigates to /account-setting.html, waits for auth ready.
  - Clicks the [data-action="logout"] button.
  - Asserts redirect to /login.
  - Opens a new page and tries to visit /dashboard.
  - Asserts we are re-routed to /login or /verify-email and that no authenticated nav/user menu is visible.
- Protected-route tests:
  - /resume-feedback-pro.html and /account-setting.html with storageState: undefined + cleared storage must redirect to /login or /verify-email.

**Why:**
- Directly covers the logout behavior that previously allowed stale authenticated nav after logout.
- Ensures static-auth-guard and related auth gating keep critical pages protected for unauthenticated sessions.

### 2. Marketing auth-handoff E2E (D+E+F)

**File:**
- app/tests/e2e/marketing-auth.spec.js

**What:**
- New Marketing Site Auth Handoff suite using MARKETING_BASE (defaults to https://jobhackai.io).
- Test: `marketing site shows visitor nav after logout (handoff cleared)`:
  - Builds a marketing URL with fresh handoff params: ?jhai_auth=1&jhai_plan=premium&jhai_ts=<now>.
  - Navigates to that URL and allows marketing/js/navigation.js to persist the handoff into sessionStorage.
  - Asserts that either authenticated-style nav or a CTA is present (sanity check that nav rendered).
  - Clears the handoff in sessionStorage and sets jhai_auth=0 for .jobhackai.io via document.cookie.
  - Reloads marketing (MARKETING_BASE + "/").
  - Asserts no authenticated nav elements (plan badge / user menu) and that visitor CTAs like “Start Free Trial” / “Log in” are visible.

**Why:**
- This test directly exercises the D+E+F logic we added/fixed:
  - D: referrer-based clearing of stale handoff when coming from the app without auth params.
  - E: logout cookie as a negative signal (jhai_auth=0) to distrust URL handoff.
  - F: shortened TTL and use of original ts so handoff window is bounded.
- Helps ensure we won’t regress the “can’t walk out” bug where marketing nav stayed in a premium/authenticated state after logout.

### 3. Account settings + billing portal E2Es

**File:**
- app/tests/e2e/account-settings.spec.js

**What:**
- `account settings page loads`:
  - Goes to /account-setting.html, waits for auth ready.
  - Asserts we didn’t get bounced back to /login.
  - Waits for the [data-action="logout"] button to be visible (indicates profile content is loaded, not just skeleton).
- `billing management opens Stripe portal`:
  - Same page setup as above.
  - Uses getAuthToken(page) to obtain a Firebase ID token.
  - Calls /api/billing-portal directly via Playwright’s page.request.
  - Accepts statuses [200, 400, 401, 403, 404] (success, expected auth/plan errors) and on 200 asserts billing.stripe.com URL.
- `logout from account settings works`:
  - Clicks the log-out button and asserts redirect to /login.

**Why:**
- We now have explicit coverage for account-settings rendering, billing portal API behavior, and logout from that page.
- This is a common user path (view subscription, manage billing, log out) and a high-value SaaS robustness check.

### 4. Error-handling smoke for plan API failures

**File:**
- app/tests/e2e/error-handling.spec.js

**What:**
- Routes **/api/plan/me** to always return 500 with a small JSON error body.
- Navigates to /dashboard, waits a few seconds.
- Captures pageerror events and asserts there are no critical uncaught exceptions that match common failure patterns.
- Asserts the body remains visible (no blank UI / catastrophic failure).

**Why:**
- Validates that the dashboard can degrade gracefully when plan API is down, instead of throwing hard runtime errors or leaving a blank page.

### 5. Real API smoke for core SaaS endpoints

**File:**
- app/tests/e2e/smoke-real-api.spec.js

**What:**
- `GET /api/plan/me returns valid plan`:
  - Uses waitForAuthReady + getAuthToken.
  - Calls /api/plan/me and asserts 200 + plan ∈ {free, trial, essential, pro, premium}.
- `GET /api/billing-status returns valid response`:
  - Same setup as plan test.
  - Calls /api/billing-status?force=1.
  - Accepts 200/401/403 and, when there is a body, asserts it parses as an object.

**Why:**
- Adds a small “real API smoke” layer on top of the heavier, mostly-mocked full-app-check suite.
- This should quickly catch broken deployments where the app boots but key auth/billing APIs are misconfigured.

### 6. Env loader precedence fix (.env vs .env.test.local)

**Files:**
- app/tests/fixtures/global-setup.js
- app/tests/playwright.config.js

**What:**
- Previously loaded .env.test.local first, then .env, so base .env values could overwrite local .env.test.local values for the same keys.
- Now we load .env first, then .env.test.local:
  - loadEnvFile(path.join(appDir, '.env'));
  - loadEnvFile(path.join(appDir, '.env.test.local'));

**Why:**
- Matches standard env-file conventions: .env provides shared defaults; .env.test.local (gitignored) provides developer-local overrides.
- Ensures local TEST_EMAIL, TEST_PASSWORD, or TEST_ENV in .env.test.local actually override any values in .env when running E2E tests locally, while CI continues to rely on environment/secret injection.

## Testing

- Ran the full Playwright suite locally from app/:
  - npm run test:e2e
  - Result: 23 passed, 8 skipped, 0 failed.

