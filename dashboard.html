<!-- DO NOT EDIT HEADER OR FOOTER PER-PAGE. Use canonical snippet from docs/snippets.md. -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>html.auth-pending{visibility:hidden}</style>
  <script src="js/static-auth-guard.js?v=20251007-2"></script>
  <title>Dashboard ‚Äì JobHackAI</title>
  <link rel="icon" type="image/png" href="assets/JobHackAI_Logo_favicon-32x32.png">
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <style>
    .dashboard-banner {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(31,41,55,0.07);
      padding: 1.2rem 2rem 1.2rem 2rem;
      margin: 2rem auto 2.2rem auto;
      max-width: 540px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      position: relative;
      align-items: flex-start;
    }
    .dashboard-banner .settings-link {
      position: absolute;
      top: 1.1rem;
      right: 1.2rem;
      color: #6B7280;
      font-size: 1.1rem;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.2rem;
      transition: color 0.18s;
      opacity: 0.7;
    }
    .dashboard-banner .settings-link:hover {
      color: #232B36;
      text-decoration: underline;
      opacity: 1;
    }
    .dashboard-banner .welcome-row {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.08rem;
      margin-bottom: 0.1rem;
    }
    .dashboard-banner .welcome-row h2 {
      font-size: 1.32rem;
      font-weight: 800;
      color: #232B36;
      margin: 0 0 0.08rem 0;
      padding: 0;
    }
    .dashboard-banner .trial-countdown {
      color: #D97706;
      font-weight: 600;
      font-size: 1.01rem;
      margin: 0.05rem 0 0.05rem 0;
      padding: 0;
      line-height: 1.2;
    }
    .dashboard-banner .user-email {
      font-size: 0.98rem;
      color: #6B7280;
      margin-bottom: 0.1rem;
      font-weight: 400;
      letter-spacing: 0.01em;
    }
    .dashboard-banner .plan-badge {
      display: inline-block;
      background: #F3F4F6;
      color: #0077B5;
      font-weight: 700;
      border-radius: 8px;
      padding: 0.18rem 0.7rem;
      font-size: 0.98rem;
      margin-left: 0;
      margin-top: 0.2rem;
    }
    .dashboard-banner .upgrade-btn {
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.5rem;
      font-size: 1.01rem;
      cursor: pointer;
      margin-top: 0.5rem;
      align-self: flex-start;
      transition: background 0.18s;
      text-decoration: none;
      display: inline-block;
    }
    .dashboard-banner .upgrade-btn:hover,
    .dashboard-banner .upgrade-btn:focus {
      background: #00c965;
      text-decoration: none;
      outline: none;
    }
    .dashboard-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
      gap: 1.5rem;
      max-width: 1100px;
      margin: 0 auto 2.5rem auto;
    }
    .feature-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(31,41,55,0.07);
      padding: 1.5rem 1.2rem 1.2rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      align-items: flex-start;
      min-height: 210px;
      position: relative;
    }
    .feature-card.locked {
      opacity: 0.7;
    }
    .feature-card .feature-title {
      font-size: 1.13rem;
      font-weight: 700;
      margin-bottom: 0.2rem;
      color: #232B36;
    }
    .feature-card .feature-desc {
      font-size: 1rem;
      color: #4B5563;
      margin-bottom: 0.7rem;
    }
    .feature-card .feature-action {
      margin-top: auto;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .feature-card .feature-action .btn-primary,
    .feature-card .feature-action a.btn-primary {
      padding: 0.7rem 1.5rem;
    }
    .feature-card .feature-action .btn-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #fff !important;
      color: #1976D2 !important;
      border: 1.5px solid #1976D2;
      font-weight: 600;
      border-radius: 12px;
      font-size: 1.02rem;
      min-width: 160px;
      font-family: 'Inter', Arial, sans-serif;
      text-align: center;
      text-decoration: none;
      transition: background 0.18s, color 0.18s, border-color 0.18s;
      cursor: pointer;
    }
    .feature-card .feature-action .btn-primary:hover,
    .feature-card .feature-action .btn-primary:focus {
      background: #1976D2 !important;
      color: #fff !important;
      border-color: #1976D2;
      text-decoration: none;
      outline: none;
    }
    .feature-card .feature-action .btn-secondary {
      width: 100%;
      min-width: 0;
      font-size: 1.02rem;
      padding: 0.7rem 0;
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
      text-decoration: none;
    }
    .feature-card .feature-action .btn-locked {
      background: #00E676;
      color: #fff;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      cursor: pointer;
      font-weight: 700;
      border-radius: 8px;
      width: 100%;
      font-size: 1.02rem;
      padding: 0.7rem 0;
      transition: background 0.18s;
    }
    .feature-card .feature-action .btn-locked:hover,
    .feature-card .feature-action .btn-locked:focus {
      background: #00c965;
      outline: none;
    }
    .feature-card .included-badge {
      color: #00C853;
      font-size: 0.98rem;
      font-weight: 600;
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .feature-card .included-badge svg {
      vertical-align: middle;
    }
    @media (max-width: 700px) {
      .dashboard-banner, .dashboard-features {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      .dashboard-banner {
        max-width: 98vw;
      }
      .dashboard-features {
        grid-template-columns: 1fr;
      }
    }
    .ats-score-row {
      display: flex;
      align-items: center;
      gap: 1.1rem;
      margin: 0.5rem 0 0.2rem 0;
    }
    .ats-donut {
      width: 54px;
      height: 54px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ats-donut svg {
      width: 54px;
      height: 54px;
      transform: rotate(-90deg);
    }
    .ats-donut .ats-score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.1rem;
      font-weight: 700;
      color: #111;
      text-align: center;
      letter-spacing: 0.5px;
    }
    .ats-score-details {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .ats-score-details .ats-score-label {
      font-size: 1.05rem;
      font-weight: 700;
      color: #232B36;
      margin-bottom: 0.1rem;
    }
    .ats-score-details .ats-score-summary {
      font-size: 1rem;
      color: #4B5563;
      max-width: 340px;
    }
    .user-plan-status {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 1.2rem;
      gap: 0.3rem;
    }
    .user-plan-label {
      font-size: 0.92rem;
      color: #6B7280;
      font-weight: 500;
      margin-bottom: 0.1rem;
      letter-spacing: 0.01em;
    }
    .user-plan-badge {
      font-size: 1.02rem;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.5rem 1.1rem 0.5rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .user-plan-badge.trial {
      color: #FF9100;
      background: #FFF7E6;
    }
    .user-plan-badge.essential {
      color: #0077B5;
      background: #E3F2FD;
    }
    .user-plan-badge.pro {
      color: #388E3C;
      background: #E8F5E9;
    }
    .user-plan-badge.premium {
      color: #C62828;
      background: #FFEBEE;
    }
    .user-plan-icon {
      width: 1.1em;
      height: 1.1em;
      vertical-align: middle;
    }
    .dashboard-banner .upgrade-btn {
      width: 100%;
      margin-top: 0.2rem;
    }
    .dashboard-banner-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 1rem;
      width: 100%;
      margin-top: 1.2rem;
      padding-top: 0.7rem;
      border-top: 1px solid #F3F4F6;
    }
    .user-plan-badge {
      font-size: 1.05rem;
      font-weight: 700;
      border-radius: 999px;
      padding: 0.22rem 1.1rem 0.22rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .user-plan-badge.essential {
      color: #0077B5;
      background: #E3F2FD;
    }
    .user-plan-badge.pro {
      color: #388E3C;
      background: #E8F5E9;
    }
    .user-plan-badge.premium {
      color: #C62828;
      background: #FFEBEE;
    }
    .user-plan-icon {
      width: 1.1em;
      height: 1.1em;
      vertical-align: middle;
    }
    .dashboard-banner-footer .upgrade-btn {
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1.2rem;
      font-size: 1.01rem;
      cursor: pointer;
      transition: background 0.18s;
      text-decoration: none;
      min-width: unset;
      width: auto;
      margin-top: 0;
    }
    .dashboard-banner-footer .upgrade-btn:hover,
    .dashboard-banner-footer .upgrade-btn:focus {
      background: #00c965;
    }
    .status-action-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: flex-end;
      gap: 0.7rem;
      margin-top: 0.5rem;
      width: 100%;
    }
    .user-plan-badge {
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      font-weight: 600;
      border-radius: 999px;
      padding: 0.4rem 1.1rem;
      font-size: 1.01rem;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .status-action-row .upgrade-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #1976D2;
      color: #fff;
      border: none;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.6rem 1.5rem;
      font-size: 1.02rem;
      min-width: 0;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
      transition: background 0.18s, color 0.18s, border-color 0.18s;
      text-decoration: none;
      margin-top: 0;
      width: auto;
    }
    .status-action-row .upgrade-btn:hover,
    .status-action-row .upgrade-btn:focus {
      background: #125bb5;
      color: #fff;
    }
    .jh-tooltip-trigger {
      cursor: pointer;
      margin-left: 0.4em;
      vertical-align: middle;
      position: relative;
      display: inline-block;
    }
    .jh-tooltip-text {
      display: none;
      position: absolute;
      z-index: 1000;
      padding: 0.5rem 0.8rem;
      background-color: #333;
      color: #fff;
      border-radius: 4px;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      min-width: 180px;
      max-width: 260px;
      white-space: normal;
      word-break: break-word;
      font-size: 0.98rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      pointer-events: none;
      text-align: left;
    }
    .jh-tooltip-trigger:hover .jh-tooltip-text,
    .jh-tooltip-trigger:focus .jh-tooltip-text,
    .jh-tooltip-trigger:focus-visible .jh-tooltip-text {
      display: block;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Header (canonical) -->
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="nav-logo" aria-label="Go to homepage">
        <svg width="24" height="24" fill="none" stroke="#1F2937" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        <span>JOBHACKAI</span>
      </a>
      <div class="nav-group">
        <nav class="nav-links" role="navigation">
          <!-- Navigation will be dynamically populated by navigation.js -->
          <a href="index.html#blog">Blog</a>
        </nav>
      </div>
      <button class="mobile-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobileNav">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </header>
  <nav class="mobile-nav" id="mobileNav">
    <!-- Mobile navigation will be dynamically populated by navigation.js -->
  </nav>
  <script>
    // Hamburger menu toggle
    const mobileToggle = document.querySelector('.mobile-toggle');
    const mobileNav = document.getElementById('mobileNav');
    if (mobileToggle && mobileNav) {
      mobileToggle.addEventListener('click', () => {
        const isOpen = mobileNav.classList.toggle('open');
        mobileToggle.setAttribute('aria-expanded', isOpen);
      });
      // Close mobile nav on link click
      document.querySelectorAll('.mobile-nav a').forEach(link => {
        link.addEventListener('click', () => {
          mobileNav.classList.remove('open');
          mobileToggle.setAttribute('aria-expanded', 'false');
        });
      });
    }
  </script>
  <!-- Main Content -->
  <main>
    <div id="dashboard-root"></div>
  </main>
  <!-- Footer (canonical) -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-brand">
        <svg class="footer-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2" stroke="#1F2937" stroke-width="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1F2937" stroke-width="2"/>
        </svg>
        <span class="footer-name">JOBHACKAI</span>
      </div>
      <div class="footer-legal">
        <p>¬© 2025 JobHackAI. All rights reserved.</p>
      </div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="support.html">Support</a>
        <a href="privacy.html">Privacy</a>
      </div>
    </div>
  </footer>
  <script src="js/free-account-manager.js"></script>
  <script src="js/universal-logout.js?v=20251007-2"></script>
  <script>
    // --- CROSS-TAB LOGOUT SYNC ONLY ---
    (function(){
      try {
        // Cross-tab logout sync only - removed problematic auth guard
        const ch = new BroadcastChannel('auth');
        ch.onmessage = (e) => { 
          if (e?.data?.type === 'logout') location.replace('login.html'); 
        };
      } catch(_) {}
    })();

    // --- HELPER FUNCTIONS ---
    async function getFirebaseIdToken() {
      try {
        if (window.firebase && window.firebase.auth) {
          const auth = window.firebase.auth.getAuth();
          const user = auth.currentUser;
          if (user) {
            return await user.getIdToken();
          }
        }
        return null;
      } catch (error) {
        console.warn('Could not get Firebase token:', error);
        return null;
      }
    }

    // --- ENHANCED AUTHENTICATION CHECK ---
    async function checkAuthentication() {
      // Version stamp for deployment verification
      console.log('üîß dashboard.html VERSION: redirect-fix-v3-STRIPE-SYNC-ADDED - ' + new Date().toISOString());

      // Prevent redirect loop - check if we came from login
      const cameFromLogin = document.referrer && document.referrer.includes('login.html');
      const redirectAttempts = parseInt(sessionStorage.getItem('dashboard-redirect-attempts') || '0');

      console.log('üîç Dashboard auth check:', {
        referrer: document.referrer,
        cameFromLogin,
        redirectAttempts,
        localStorage: {
          authenticated: localStorage.getItem('user-authenticated'),
          email: localStorage.getItem('user-email')
        }
      });

      // If we came from login, wait for Firebase to initialize
      if (cameFromLogin) {
        console.log('‚è≥ Came from login, waiting for Firebase auth state...');
        
        // Wait up to 3 seconds for Firebase to set auth state
        let waitCount = 0;
        const maxWait = 30; // 3 seconds (100ms intervals)
        
        while (waitCount < maxWait) {
          const isAuth = localStorage.getItem('user-authenticated') === 'true';
          const hasEmail = !!localStorage.getItem('user-email');
          
          if (isAuth && hasEmail) {
            console.log('‚úÖ Firebase auth state confirmed after', waitCount * 100, 'ms');
            break;
          }
          
          await new Promise(resolve => setTimeout(resolve, 100));
          waitCount++;
        }
      }

      const isAuthenticated = localStorage.getItem('user-authenticated') === 'true' && !!localStorage.getItem('user-email');
      const userEmail = localStorage.getItem('user-email');
      const userPlan = localStorage.getItem('user-plan');
      const mainContent = document.querySelector('main');
      
      if (!isAuthenticated || !userEmail) {
        // Track redirect attempts to prevent infinite loops
        sessionStorage.setItem('dashboard-redirect-attempts', String(redirectAttempts + 1));
        
        if (redirectAttempts >= 3) {
          console.error('üö® Too many redirect attempts, clearing state');
          localStorage.clear();
          sessionStorage.clear();
          alert('Authentication error. Please clear your browser cache and try logging in again.');
          window.location.href = 'login.html';
          return false;
        }
        
        if (cameFromLogin) {
          console.error('‚ö†Ô∏è Redirect loop detected! Came from login but not authenticated after wait.');
          alert('Authentication error. Please try logging in again.');
          localStorage.clear();
        }
        
        console.log('‚ùå Not authenticated, redirecting to login (attempt', redirectAttempts + 1, ')');
        window.location.href = 'login.html';
        return false;
      }

      // Clear redirect attempts on successful auth
      sessionStorage.removeItem('dashboard-redirect-attempts');
      
      if (!isAuthenticated || !userEmail) {
        // Clear any stale authentication data
        localStorage.removeItem('user-authenticated');
        localStorage.removeItem('user-email');
        localStorage.removeItem('user-plan');
        localStorage.removeItem('user-db');
        
        mainContent.innerHTML = `
          <div style="max-width: 600px; margin: 4rem auto; text-align: center; padding: 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üîí</div>
            <h1 style="font-size: 2rem; font-weight: 700; color: var(--color-text-main); margin-bottom: 1rem;">
              Authentication Required
            </h1>
            <p style="font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 2rem; line-height: 1.6;">
              You need to be logged in to access your dashboard. 
              Please sign in to view your account and tools.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
              <a href="login.html" class="btn-primary" style="text-decoration: none;">
                Sign In
              </a>
              <a href="pricing-a.html" class="btn-outline" style="text-decoration: none;">
                View Pricing
              </a>
            </div>
          </div>
        `;
        return false;
      }
      
      // Validate user plan exists
      if (!userPlan) {
        console.warn('User authenticated but no plan found, setting to free');
        localStorage.setItem('user-plan', 'free');
      }
      
      return true;
    }

    // --- AUTHENTICATION STATE MANAGEMENT ---
    function getAuthState() {
      // Check for actual authentication (this would integrate with Firebase Auth)
      // For now, we'll use localStorage as a placeholder
      const isAuthenticated = localStorage.getItem('user-authenticated') === 'true';
      const userPlan = localStorage.getItem('user-plan') || 'free';
      
      return {
        isAuthenticated,
        userPlan: isAuthenticated ? userPlan : null
      };
    }

    // --- Initialize on load ---
    document.addEventListener('DOMContentLoaded', async function() {
      // Check authentication first
      const authOk = await checkAuthentication();
      if (!authOk) {
        return; // Stop here if not authenticated
      }
      
      // Get user data from authentication system
      const authState = getAuthState();
      
      // Force KV plan fetch when landing with ?paid=1 or on dashboard load
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('paid') === '1' || authState.userPlan === 'pending') {
        console.log('üîÑ Forcing KV plan refresh (paid=1 or pending plan)');
        if (window.JobHackAINavigation?.fetchKVPlan) {
          try {
            const freshPlan = await window.JobHackAINavigation.fetchKVPlan();
            if (freshPlan) {
              console.log('‚úÖ Fetched fresh plan from KV:', freshPlan);
              localStorage.setItem('user-plan', freshPlan);
              // Force navigation update
              if (window.JobHackAINavigation?.setAuthState) {
                window.JobHackAINavigation.setAuthState(true, freshPlan);
              }
            }
          } catch (e) {
            console.warn('‚ö†Ô∏è Could not fetch plan from KV:', e);
          }
        }
      }
      
      // Wait for navigation system to be ready
      let currentPlan = 'free';
      if (window.JobHackAINavigation && typeof window.JobHackAINavigation.getEffectivePlan === 'function') {
        currentPlan = window.JobHackAINavigation.getEffectivePlan();
        console.log('‚úÖ Got plan from navigation:', currentPlan);
      } else {
        // Fallback: try localStorage directly
        currentPlan = localStorage.getItem('user-plan') || 'free';
        console.log('‚ö†Ô∏è Navigation not ready, using localStorage plan:', currentPlan);
      }

      // If coming from Stripe with ?paid=1 but KV says 'free', force sync
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('paid') === '1' && currentPlan === 'free') {
        console.log('üîÑ KV mismatch detected, forcing Stripe sync...');
        try {
          // Get Firebase ID token for authentication
          const firebaseToken = await getFirebaseIdToken();
          if (firebaseToken) {
            const syncResponse = await fetch('/api/sync-stripe-plan', {
              method: 'POST',
              headers: { 
                'Authorization': `Bearer ${firebaseToken}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (syncResponse.ok) {
              const syncData = await syncResponse.json();
              if (syncData.plan && syncData.plan !== 'free') {
                console.log('‚úÖ Sync successful, updating plan:', syncData.plan);
                currentPlan = syncData.plan;
                localStorage.setItem('user-plan', currentPlan);
                if (syncData.trialEndsAt) {
                  localStorage.setItem('trial-ends-at', syncData.trialEndsAt);
                  console.log('‚úÖ Updated trial end date:', syncData.trialEndsAt);
                }
                
                // Force navigation update with new plan
                if (window.JobHackAINavigation?.setAuthState) {
                  window.JobHackAINavigation.setAuthState(true, currentPlan);
                }
              } else {
                console.log('‚ö†Ô∏è Sync returned free plan, keeping current');
              }
            } else {
              console.warn('‚ö†Ô∏è Sync failed:', syncResponse.status);
            }
          } else {
            console.warn('‚ö†Ô∏è Could not get Firebase token for sync');
          }
        } catch (syncError) {
          console.warn('‚ö†Ô∏è Sync error:', syncError);
        }
      }

      console.log('üìä Dashboard Debug:', {
        'user-plan': localStorage.getItem('user-plan'),
        'trial-ends-at': localStorage.getItem('trial-ends-at'),
        'user-authenticated': localStorage.getItem('user-authenticated'),
        'currentPlan': currentPlan
      });
      
      // Create user object from authentication data
      const user = {
        name: "User", // This would come from the auth system
        email: "user@example.com", // This would come from the auth system
        plan: currentPlan,
        trialEndsAt: localStorage.getItem('trial-ends-at') || new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
        hasUsedFreeTrial: true,
        hasUsedFreeATS: true
      };
      
      // Continue with existing dashboard logic
      renderDashboard(user);
    });

    // --- USER DATA INJECTION (replace with your data source, e.g. from Google Sheets or Wix Data) ---
    // Note: This is now handled in the DOMContentLoaded function above

    // --- FEATURE MATRIX ---
    const featureMatrix = {
      free:     ["ats"],
      trial:    ["ats", "feedback", "interview"],
      essential:["ats", "feedback", "interview"],
      pro:      ["ats", "feedback", "interview", "rewriting", "coverLetter", "mockInterview"],
      premium:  ["ats", "feedback", "interview", "rewriting", "coverLetter", "mockInterview", "linkedin", "priorityReview"]
    };
    // --- FEATURE DEFINITIONS ---
    const features = [
      {
        key: "ats",
        title: "ATS Resume Score",
        desc: "Receive an overall ATS compliance score for your resume, highlighting key areas to improve.",
        action: "Upload PDF",
        included: true
      },
      {
        key: "feedback",
        title: "Resume Feedback",
        desc: "Get a detailed analysis of what's working and what could be improved across every section of your resume.",
        action: "Upgrade to Unlock",
        included: true
      },
      {
        key: "interview",
        title: "Interview Questions",
        desc: "Receive a curated set of practice interview questions tailored to your target role.",
        action: "Start Practice",
        included: true
      },
      {
        key: "rewriting",
        title: "Resume Rewriting",
        desc: "See a rewritten version of your resume tailored to your target job ‚Äì ready to copy and paste.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "coverLetter",
        title: "Cover Letter Generator",
        desc: "Generate an ATS-optimized, job-specific cover letter in a confident, professional tone.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "mockInterview",
        title: "Mock Interviews",
        desc: "Practice real-time mock interviews with AI feedback to refine your answers and delivery.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "linkedin",
        title: "LinkedIn Optimizer",
        desc: "Optimize your LinkedIn profile section-by-section for maximum recruiter visibility.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "priorityReview",
        title: "Priority Review",
        desc: "Get your documents reviewed by our AI with expedited turnaround.",
        action: "Upgrade to Unlock",
        included: false
      }
    ];
    // --- RENDER LOGIC ---
    function daysLeft(trialEndsAt) {
      const now = new Date();
      const end = new Date(trialEndsAt);
      const diff = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
      return diff > 0 ? diff : 0;
    }
    // Example ATS score (replace with real value from backend or Google Sheets)
    const atsScore = {
      percent: 78, // 0-100
      value: 78,
      max: 100,
      summary: "Your resume meets many ATS criteria and is likely to be noticed."
    };
    function renderDashboard(user) {
      const root = document.getElementById('dashboard-root');
      const unlocked = featureMatrix[user.plan] || [];
      // ATS Donut SVG (green ring, black text)
      function atsDonut(percent) {
        const radius = 23;
        const stroke = 3;
        const norm = 2 * Math.PI * radius;
        const progress = (percent / 100) * norm;
        return `
          <div class="ats-donut" aria-label="ATS Score">
            <svg viewBox="0 0 54 54">
              <circle cx="27" cy="27" r="${radius}" stroke="#E5E7EB" stroke-width="${stroke}" fill="none"/>
              <circle cx="27" cy="27" r="${radius}" stroke="#00E676" stroke-width="${stroke}" fill="none" stroke-dasharray="${norm}" stroke-dashoffset="${norm - progress}" stroke-linecap="round"/>
            </svg>
            <span class="ats-score-text">${percent}%</span>
          </div>
        `;
      }
      // Banner
      function planIcon(plan) {
        switch (plan) {
          case 'trial':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#FF9100" opacity="0.12"/><path d="M10 4v7l4 2" stroke="#FF9100" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
          case 'essential':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#0077B5" opacity="0.12"/><path d="M10 5v10M5 10h10" stroke="#0077B5" stroke-width="1.5" stroke-linecap="round"/></svg>`;
          case 'pro':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#388E3C" opacity="0.12"/><path d="M6 10l3 3 5-5" stroke="#388E3C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
          case 'premium':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#C62828" opacity="0.12"/><path d="M10 5l2.09 4.26L17 9.27l-3.45 3.36L14.18 17 10 14.27 5.82 17l0.63-4.37L3 9.27l4.91-0.01L10 5z" stroke="#C62828" stroke-width="1.2" fill="none"/></svg>`;
          default:
            return '';
        }
      }
      let banner = `<div class="dashboard-banner">
        <a href="#" class="settings-link" aria-label="Account Settings">
          <svg width="20" height="20" fill="none" stroke="#6B7280" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06A1.65 1.65 0 0015 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 008.6 15a1.65 1.65 0 00-1.82-.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.6 8.6a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 008.6 4.6a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0015 4.6a1.65 1.65 0 001.82.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 8.6a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06A1.65 1.65 0 0015 15a1.65 1.65 0 001.82.33z"/></svg>
        </a>
        <div class="welcome-row">
          <h2>Welcome back, ${user.name || 'User'}!</h2>
          ${user.plan === 'trial' || user.plan === 'essential' || user.plan === 'pro' || user.plan === 'premium' ? `<div class="plan-transition-message" style="background:#E6F7FF;color:#1976D2;padding:0.7em 1em;border-radius:8px;margin-bottom:0.7em;font-size:1.01rem;">Your previous ATS resume score has been carried over from your free account. You now have access to more features and unlimited scoring!</div>` : ''}
          ${user.plan === 'trial' ? `<div class="trial-countdown">You have ${daysLeft(user.trialEndsAt)} day${daysLeft(user.trialEndsAt) !== 1 ? 's' : ''} left in your trial!</div>` : ''}
          <div class="user-email">${user.email}</div>
        </div>
        <div class="ats-score-row">
          ${atsDonut(atsScore.percent)}
          <div class="ats-score-details">
            <span class="ats-score-label">${atsScore.value} / ${atsScore.max}</span>
            <span class="ats-score-summary">${atsScore.summary}</span>
          </div>
        </div>
        <div class="status-action-row">
          <span class="user-plan-badge ${user.plan}">${planIcon(user.plan)}${user.plan.charAt(0).toUpperCase() + user.plan.slice(1)}</span>
          ${(user.plan === 'cancelled') ? `<a href="pricing-a.html" class="upgrade-btn">Reactivate</a>` : ''}
        </div>
      </div>`;
      // Always load last ATS score/result from localStorage if present
      let lastScore = localStorage.getItem('lastATSScore');
      let lastSummary = localStorage.getItem('lastATSSummary');
      if (lastScore && lastSummary) {
        atsScore.value = parseInt(lastScore, 10);
        atsScore.percent = parseInt(lastScore, 10);
        atsScore.summary = lastSummary;
      }
      // Features
      let featuresHtml = '<div class="dashboard-features">';
      // Always render ATS Scoring first
      const atsFeature = features.find(f => f.key === 'ats');
      const otherFeatures = features.filter(f => f.key !== 'ats');
      const orderedFeatures = [atsFeature, ...otherFeatures];
      for (const feature of orderedFeatures) {
        const isUnlocked = unlocked.includes(feature.key);
        featuresHtml += `<div class="feature-card${isUnlocked ? '' : ' locked'}">`;
        featuresHtml += `<div class="feature-title">${feature.title}</div>`;
        featuresHtml += `<div class="feature-desc">${feature.desc}</div>`;
        featuresHtml += `<div class="feature-action">`;
        if (isUnlocked && feature.key === 'ats') {
          // ATS Scoring: real upload
          featuresHtml += `<input type=\"file\" id=\"ats-upload-input\" accept=\"application/pdf\" style=\"display:none;\" />`;
          featuresHtml += `<button class=\"btn-primary\" id=\"ats-upload-btn\">${feature.action}</button>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            const usageStats = window.freeAccountManager ? window.freeAccountManager.getUsageStats() : null;
            if (usageStats && usageStats.atsScoring.remaining > 0) {
              usageText = `${usageStats.atsScoring.remaining} ATS score${usageStats.atsScoring.remaining === 1 ? '' : 's'} remaining this month.`;
            } else if (usageStats && usageStats.atsScoring.remaining === 0) {
              usageText = 'Monthly limit reached. Upgrade for unlimited scoring.';
            } else {
              usageText = '1 free ATS resume score per month.';
            }
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade for unlimited ATS scoring and detailed feedback.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = 'Unlimited ATS resume scoring during your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">You have unlimited ATS resume scoring during your trial.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'feedback') {
          // Resume Feedback: link to feedback page
          featuresHtml += `<a href=\"resume-feedback-pro.html\" class=\"btn-primary\">Get Detailed Feedback</a>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            usageText = 'Upgrade to Essential or Pro to unlock detailed feedback.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = '3 feedbacks remaining in your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">You can get up to 3 detailed feedbacks during your trial. Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          } else if (user.plan === 'essential') {
            // For demo, assume 3 left (replace with dynamic count if available)
            usageText = '3 resume feedbacks left this month.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'interview') {
          // Interview Questions: link to interview questions page
          featuresHtml += `<a href=\"interview-questions.html\" class=\"btn-primary\">${feature.action}</a>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            usageText = 'Upgrade to Essential or Pro to unlock interview questions.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Practice as much as you want during your trial.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = 'Unlimited interview questions during your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Practice as much as you want during your trial.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'rewriting') {
          // Resume Rewriting: link for Pro and Premium
          featuresHtml += `<a href="resume-feedback-pro.html#rewrite" class="btn-primary">Start Rewriting</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">Unlimited with your Pro plan. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Unlimited with your Pro plan.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'coverLetter') {
          // Cover Letter Generator: link for Pro and Premium
          featuresHtml += `<a href="cover-letter-generator.html" class="btn-primary">Generate Cover Letter</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">Unlimited with your Pro plan. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Unlimited with your Pro plan.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'mockInterview') {
          // Mock Interviews: link for Pro and Premium
          featuresHtml += `<a href="mock-interview.html" class="btn-primary">Start Mock Interview</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">20 mock interviews left this month. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Upgrade to Premium for unlimited mock interviews.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'linkedin') {
          // LinkedIn Optimizer: link for Premium
          featuresHtml += `<a href=\"linkedin-optimizer.html\" class=\"btn-primary\">Optimize LinkedIn</a>`;
        } else if (isUnlocked && feature.key === 'priorityReview') {
          // Priority Review: icon and text for Premium
          featuresHtml += `<div style=\"display:flex;align-items:center;gap:0.6rem;margin:0.7rem 0 0.2rem 0;\"><svg width=\"22\" height=\"22\" fill=\"none\" stroke=\"#00E676\" stroke-width=\"2\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M12 8v4l2.5 2.5\"/></svg><span style=\"font-weight:600;color:#00C853;\">All your AI-generated content will get priority review.</span></div>`;
        } else {
          featuresHtml += `<button class=\"btn-locked\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"8\" rx=\"2\"/><path d=\"M7 11V7a5 5 0 0110 0v4\"/></svg> ${feature.action}</button>`;
        }
        featuresHtml += `</div>`;
        if (isUnlocked && (user.plan === 'trial' || user.plan === 'essential' || user.plan === 'pro' || user.plan === 'premium')) {
          featuresHtml += `<div class="included-badge"><svg width="16" height="16" fill="#00C853" viewBox="0 0 24 24"><path d="M20.285 6.709a1 1 0 00-1.414-1.418l-9.192 9.192-4.242-4.242a1 1 0 00-1.414 1.414l4.949 4.95a1 1 0 001.414 0l9.899-9.896z"/></svg> Included in ${user.plan === 'trial' ? 'Trial' : user.plan.charAt(0).toUpperCase() + user.plan.slice(1)}</div>`;
        }
        featuresHtml += `</div>`;
      }
      featuresHtml += '</div>';
      root.innerHTML = banner + featuresHtml;
      // --- ATS Upload Button Logic ---
      const atsUploadBtn = document.getElementById('ats-upload-btn');
      const atsUploadInput = document.getElementById('ats-upload-input');
      if (atsUploadBtn && atsUploadInput) {
        atsUploadBtn.addEventListener('click', () => atsUploadInput.click());
        atsUploadInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (!file) return;

          // Check free account usage limits
          const userPlan = window.JobHackAINavigation ? window.JobHackAINavigation.getEffectivePlan() : 'free';
          if (userPlan === 'free' && window.freeAccountManager) {
            const usageCheck = window.freeAccountManager.canUseATSScoring();
            if (!usageCheck.allowed) {
              // Show upgrade modal
              const upgradeMsg = window.freeAccountManager.getUpgradeMessage();
              if (upgradeMsg) {
                alert(`${upgradeMsg.title}\n\n${upgradeMsg.message}`);
                // Redirect to pricing
                window.location.href = 'pricing-a.html';
                return;
              }
            }
          }

          // Store last uploaded resume in localStorage for use on Resume Feedback page
          const reader = new FileReader();
          reader.onload = function(evt) {
            // Store as base64 string (for demo; in production, use backend or secure storage)
            localStorage.setItem('lastUploadedResume', evt.target.result);
            // Optionally, store file name
            localStorage.setItem('lastUploadedResumeName', file.name);
          };
          reader.readAsDataURL(file);

          // Record usage for free accounts
          if (userPlan === 'free' && window.freeAccountManager) {
            const usageResult = window.freeAccountManager.recordATSUsage();
            if (!usageResult.success) {
              alert(usageResult.message);
              return;
            }
          }

          // Simulate ATS scoring and update donut/summary
          const score = Math.floor(Math.random() * 31) + 60; // 60-90%
          const summary = score > 85 ? 'Excellent! Your resume is highly ATS compatible.' : score > 70 ? 'Your resume meets many ATS criteria and is likely to be noticed.' : 'Your resume needs improvement for better ATS results.';
          // Update donut
          const donut = document.querySelector('.ats-donut');
          if (donut) {
            const radius = 23;
            const norm = 2 * Math.PI * radius;
            const progress = (score / 100) * norm;
            const svg = donut.querySelector('svg');
            if (svg) {
              const circles = svg.querySelectorAll('circle');
              if (circles[1]) circles[1].setAttribute('stroke-dashoffset', (norm - progress));
            }
            const text = donut.querySelector('.ats-score-text');
            if (text) text.textContent = score + '%';
          }
          // Update score label and summary
          const scoreLabel = document.querySelector('.ats-score-label');
          if (scoreLabel) scoreLabel.textContent = score + ' / 100';
          const scoreSummary = document.querySelector('.ats-score-summary');
          if (scoreSummary) scoreSummary.textContent = summary;
        });
      }
      // NOTE: Resume Feedback page should read the last uploaded resume from localStorage (key: 'lastUploadedResume') if present.
    }
  </script>
  <!-- Load navigation system -->
  <script src="js/navigation.js?v=20251007-2"></script>
  <script>
    if (window.JobHackAINavigation && typeof window.JobHackAINavigation.initializeNavigation === 'function') {
      window.JobHackAINavigation.initializeNavigation();
    } else {
      window.addEventListener('DOMContentLoaded', function() {
        if (window.JobHackAINavigation && typeof window.JobHackAINavigation.initializeNavigation === 'function') {
          window.JobHackAINavigation.initializeNavigation();
        }
      });
    }
  </script>
  <script src="js/main.js" type="module"></script>
  <script src="js/analytics.js" type="module"></script>
</body>
</html> 