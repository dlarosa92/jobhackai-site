<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Card to Start Free Trial – JobHackAI</title>
  <link rel="icon" type="image/png" href="assets/JobHackAI_Logo_favicon-32x32.png">
  <link rel="stylesheet" href="css/tokens.css" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/footer.css" />
  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .card-container {
      max-width: 420px;
      margin: 3.5rem auto 2.5rem auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 24px rgba(31,41,55,0.07);
      padding: 2.5rem 2rem 2rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card-title {
      font-size: 1.4rem;
      font-weight: 800;
      margin-bottom: 0.7rem;
      color: #232B36;
      text-align: center;
    }
    .card-sub {
      color: #4B5563;
      margin-bottom: 1.2rem;
      font-size: 1.08rem;
      text-align: center;
    }
    .stripe-box,
    #stripeElement,
    .demo-card-input {
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
    }
    .demo-card-input input {
      width: 100%;
      box-sizing: border-box;
    }
    .StripeElement {
      width: 100% !important;
      box-sizing: border-box;
      max-width: 100%;
    }
    .card-error {
      color: #FF3B30;
      font-size: 0.98rem;
      margin-bottom: 0.7rem;
      text-align: left;
      width: 100%;
      display: none;
    }
    .card-btn {
      width: 100%;
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.95rem 0;
      font-size: 1.13rem;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s;
      text-decoration: none;
      margin-top: 0.5rem;
    }
    .card-btn:disabled {
      background: #BDBDBD;
      cursor: not-allowed;
    }
    .card-reassure {
      color: #1976D2;
      font-size: 0.98rem;
      margin-top: 1.1rem;
      text-align: center;
    }
    
    /* Trust & Compliance Styles */
    .trust-compliance {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #F8FAFC;
      border-radius: 12px;
      border: 1px solid #E2E8F0;
      width: 100%;
    }
    .trust-compliance h4 {
      font-size: 0.95rem;
      font-weight: 700;
      color: #232B36;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .trust-compliance p {
      font-size: 0.88rem;
      color: #64748B;
      margin-bottom: 0.8rem;
      line-height: 1.4;
    }
    .compliance-links {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 0.8rem;
    }
    .compliance-links a {
      font-size: 0.85rem;
      color: #1976D2;
      text-decoration: underline;
      transition: color 0.18s;
    }
    .compliance-links a:hover {
      color: #125bb5;
    }
    .stripe-badge {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      color: #64748B;
      margin-top: 0.5rem;
    }
    
    /* Saved Payment Methods Styles */
    .saved-payment-section {
      width: 100%;
      margin-bottom: 1.5rem;
      display: none;
    }
    .saved-payment-section.show {
      display: block;
    }
    .saved-card {
      background: #F8FAFC;
      border: 2px solid #E2E8F0;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: border-color 0.18s, background 0.18s;
    }
    .saved-card:hover {
      border-color: #1976D2;
      background: #F0F7FF;
    }
    .saved-card.selected {
      border-color: #00E676;
      background: #F0FFF4;
    }
    .saved-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .saved-card-number {
      font-weight: 600;
      color: #232B36;
      font-size: 0.95rem;
    }
    .saved-card-expiry {
      font-size: 0.85rem;
      color: #64748B;
    }
    .saved-card-type {
      font-size: 0.8rem;
      color: #1976D2;
      background: #E0F2FE;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }
    .add-new-card-btn {
      background: none;
      border: 2px dashed #CBD5E1;
      border-radius: 12px;
      padding: 1rem;
      width: 100%;
      color: #64748B;
      font-size: 0.9rem;
      cursor: pointer;
      transition: border-color 0.18s, color 0.18s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .add-new-card-btn:hover {
      border-color: #1976D2;
      color: #1976D2;
    }
    
    /* Trial Reminder Styles */
    .trial-reminder {
      background: #FFF7ED;
      border: 1px solid #FED7AA;
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    .trial-reminder-icon {
      color: #F97316;
      font-size: 1.1rem;
      margin-top: 0.1rem;
    }
    .trial-reminder-content {
      flex: 1;
    }
    .trial-reminder-title {
      font-weight: 600;
      color: #C2410C;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    .trial-reminder-text {
      font-size: 0.85rem;
      color: #9A3412;
      line-height: 1.4;
    }
    
    @media (max-width: 600px) {
      .card-container { padding: 1.2rem 0.5rem 1.2rem 0.5rem; max-width: 98vw; }
      .compliance-links { flex-direction: column; gap: 0.5rem; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="nav-logo" aria-label="Go to homepage">
        <svg width="24" height="24" fill="none" stroke="#1F2937" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        <span>JOBHACKAI</span>
      </a>
    </div>
  </header>
  <main>
    <div class="card-container" role="main" aria-labelledby="card-title">
      <div class="card-title" id="card-title">Add a Card to Start Your Free Trial</div>
      <div class="card-sub" id="cardSub">To unlock your free trial, please add a credit card. <br><strong>You won't be charged until your trial ends.</strong></div>
      
      <!-- Trial Expiry Reminder -->
      <div class="trial-reminder" id="trialReminder" style="display:none;">
        <div class="trial-reminder-icon">⏰</div>
        <div class="trial-reminder-content">
          <div class="trial-reminder-title">Trial Reminder</div>
          <div class="trial-reminder-text">We'll send you a reminder email on the last day of your trial.</div>
        </div>
      </div>
      
      <!-- Saved Payment Methods Section -->
      <div class="saved-payment-section" id="savedPaymentSection">
        <div class="settings-label" style="font-weight:600; font-size:1.01rem; margin-bottom:0.8rem; color:#232B36;">Saved Payment Methods</div>
        <div id="savedCardsList"></div>
        <button type="button" class="add-new-card-btn" id="addNewCardBtn">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v7m0 0v7m0-7h7m-7 0H5"/>
          </svg>
          Add New Card
        </button>
      </div>
      
      <form id="cardForm" autocomplete="off" style="width:100%;">
        <div class="card-error" id="cardError" aria-live="polite"></div>
        <button type="button" class="apple-google-pay-btn" id="appleGooglePayBtn" style="width:100%;background:#232B36;color:#fff;font-weight:700;border:none;border-radius:8px;padding:0.95rem 0;font-size:1.13rem;cursor:pointer;margin-bottom:0.5rem;display:flex;align-items:center;justify-content:center;gap:0.5rem;position:relative;">
          <svg width="24" height="24" fill="none" stroke="#fff" stroke-width="2" style="vertical-align:middle;"><rect x="2" y="2" width="20" height="20" rx="4"/><path d="M7 12h10"/><path d="M12 7v10"/></svg>
          Pay with Apple Pay / Google Pay (Demo)
          <span class="pay-spinner" id="paySpinner" style="display:none;position:absolute;right:1rem;top:50%;transform:translateY(-50%);"><svg width="20" height="20" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg></span>
        </button>
        <div style="font-size:0.95rem;color:#4B5563;margin-bottom:1rem;text-align:center;">You'll be able to use any card saved to your device.</div>
        <div class="stripe-box" id="stripeElement">
          <!-- Stripe Elements will be injected here -->
          <div style="color:#BDBDBD; text-align: center; padding: 1rem;">
            <div style="margin-bottom: 0.5rem;">Loading secure payment form...</div>
            <div style="font-size: 0.9rem;">Powered by Stripe</div>
          </div>
        </div>
        <button type="submit" class="card-btn" id="cardSubmitBtn" disabled>
          <span class="btn-spinner" id="btnSpinner" style="display:none;vertical-align:middle;margin-right:0.5rem;"><svg width="20" height="20" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg></span>
          <span id="btnText">Start Free Trial</span>
        </button>
      </form>
      
      <!-- Trust & Compliance Section -->
      <div class="trust-compliance">
        <h4>
          <svg width="16" height="16" fill="none" stroke="#1976D2" stroke-width="2" role="img" aria-label="Secure">
            <title>Secure</title>
            <rect x="3" y="7" width="10" height="7" rx="2"/>
            <path d="M8 7V5a3 3 0 1 1 6 0v2"/>
            <circle cx="8" cy="11" r="1"/>
          </svg>
          Secure Payment Processing
        </h4>
        <p>Your payment information is encrypted and securely processed. We never store your full card details on our servers.</p>
        <div class="compliance-links">
          <a href="privacy.html">Privacy Policy</a>
          <a href="terms.html">Terms of Service</a>
          <a href="support.html">Payment Support</a>
        </div>
        <div class="stripe-badge">
          <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="2" width="10" height="10" rx="2"/>
            <path d="M6 6h2v2H6z"/>
          </svg>
          Secured by Stripe • PCI DSS Compliant • GDPR Compliant
        </div>
      </div>
      
      <div class="card-reassure">
        <svg width="18" height="18" fill="none" stroke="#1976D2" stroke-width="2" style="vertical-align:middle;margin-right:0.3rem;"><circle cx="9" cy="9" r="8"/><path d="M6 9l2 2 4-4"/></svg>
        100% secure. Cancel anytime during your trial.
      </div>
    </div>
  </main>
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-brand">
        <svg class="footer-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2" stroke="#1F2937" stroke-width="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1F2937" stroke-width="2"/>
        </svg>
        <span class="footer-name">JOBHACKAI</span>
      </div>
      <div class="footer-legal">
        <p>© 2025 JobHackAI. All rights reserved.</p>
      </div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="support.html">Support</a>
        <a href="privacy.html">Privacy</a>
      </div>
    </div>
  </footer>
  
  <!-- INTEGRATION: STRIPE - Collect card details and create payment method using Stripe Elements -->
  <!-- INTEGRATION: ZAPIER - After successful payment, update user plan in Google Sheets and Stripe via Zapier -->
  <!-- INTEGRATION: GOOGLE SHEETS - Store and retrieve user data for plan/account management -->
  <script src="js/stripe-integration.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // INTEGRATION: GOOGLE SHEETS - On page load, retrieve user info if needed
      // Initialize saved payment methods functionality
      initializeSavedPaymentMethods();
      
      // INTEGRATION: STRIPE - Replace demo Apple/Google Pay logic with real Stripe Payment Request Button
      var appleGooglePayBtn = document.getElementById('appleGooglePayBtn');
      var paySpinner = document.getElementById('paySpinner');
      if (appleGooglePayBtn) {
        appleGooglePayBtn.addEventListener('click', function() {
          // TODO: In production, initialize Stripe Payment Request Button here
          // In demo mode, simulate payment success with spinner
          appleGooglePayBtn.disabled = true;
          if (paySpinner) paySpinner.style.display = 'inline-block';
          setTimeout(function() {
            var container = document.querySelector('.card-container');
            if (container) {
              container.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                  <div style="color: #00E676; font-size: 3rem; margin-bottom: 1rem;">✓</div>
                  <h2 style="color: #232B36; margin-bottom: 1rem;">Payment Successful!</h2>
                  <p style="color: #4B5563;">Your payment with Apple Pay / Google Pay (Demo) was successful. Redirecting to dashboard...</p>
                </div>
              `;
              setTimeout(function() {
                window.location.href = 'dashboard.html';
              }, 2000);
            }
          }, 1200);
        });
      }
      
      // INTEGRATION: GOOGLE SHEETS - Retrieve selected plan and user info from backend/Sheets
      const selectedPlan = localStorage.getItem('selected-plan');
      const planAmount = localStorage.getItem('plan-amount');
      const reassure = document.querySelector('.card-reassure');
      const title = document.getElementById('card-title');
      const sub = document.getElementById('cardSub');
      const button = document.getElementById('cardSubmitBtn');
      const trialReminder = document.getElementById('trialReminder');
      const isTrial = !selectedPlan || selectedPlan === 'trial';
      const btnText = document.getElementById('btnText');
      if (isTrial) {
        if (title) title.textContent = 'Start Your Free Trial';
        if (sub) sub.innerHTML = 'To unlock your free trial, please add a credit card.<br><strong>You won\'t be charged until your trial ends.</strong>';
        if (btnText) btnText.textContent = 'Start Free Trial';
        if (reassure) reassure.innerHTML = '<svg width="18" height="18" fill="none" stroke="#1976D2" stroke-width="2" style="vertical-align:middle;margin-right:0.3rem;"><circle cx="9" cy="9" r="8"/><path d="M6 9l2 2 4-4"/></svg> You won\'t be charged until your trial ends. We\'ll send you a reminder before billing.';
        if (trialReminder) trialReminder.style.display = 'flex';
      } else {
        const planName = selectedPlan.charAt(0).toUpperCase() + selectedPlan.slice(1);
        if (title) title.textContent = `Add a Card to Subscribe to ${planName}`;
        if (sub) sub.innerHTML = `To start your ${planName} subscription, please add a credit card.<br><strong>You'll be charged $${(planAmount/100).toFixed(2)}/month.</strong>`;
        if (btnText) btnText.textContent = `Subscribe to ${planName}`;
        if (reassure) reassure.innerHTML = '<svg width="18" height="18" fill="none" stroke="#1976D2" stroke-width="2" style="vertical-align:middle;margin-right:0.3rem;"><circle cx="9" cy="9" r="8"/><path d="M6 9l2 2 4-4"/></svg> Cancel anytime. No long-term commitment.';
        if (trialReminder) trialReminder.style.display = 'none';
      }
      
      // INTEGRATION: STRIPE - On form submit, tokenize card and send to backend/Zapier
      // INTEGRATION: ZAPIER - After payment, update plan in Google Sheets and Stripe
      var cardForm = document.getElementById('cardForm');
      var cardBtn = document.getElementById('cardSubmitBtn');
      var btnSpinner = document.getElementById('btnSpinner');
      if (cardForm && cardBtn && btnSpinner && btnText) {
        cardForm.addEventListener('submit', function(e) {
          e.preventDefault();
          btnSpinner.style.display = 'inline-block';
          // INTEGRATION: STRIPE - Here, collect card details and send to backend/Zapier
          // INTEGRATION: ZAPIER - On success, update Google Sheets and Stripe subscription
          // INTEGRATION: GOOGLE SHEETS - Update user row with new plan/payment info
          // Keep the correct label during processing
          // btnText.textContent is already set above

          // Simulate card details (in production, get from Stripe)
          const card = {
            id: 'demo-' + Date.now(),
            brand: 'Visa',
            last4: '4242',
            expiry: '02/29',
            isDefault: true
          };
          // Save card to localStorage
          let savedCards = JSON.parse(localStorage.getItem('saved-cards') || '[]');
          // Set all others to not default
          savedCards = savedCards.map(c => ({...c, isDefault: false}));
          savedCards.push(card);
          localStorage.setItem('saved-cards', JSON.stringify(savedCards));

          // PATCH: After card is added, finalize authentication and plan
          const planToUse = localStorage.getItem('selected-plan') || 'trial';
          const userEmail = localStorage.getItem('pending-signup-email') || localStorage.getItem('user-email');
          const firstName = localStorage.getItem('pending-signup-firstName') || '';
          const lastName = localStorage.getItem('pending-signup-lastName') || '';
          if (userEmail) {
            let db = JSON.parse(localStorage.getItem('user-db') || '{}');
            if (!db[userEmail]) db[userEmail] = {};
            db[userEmail].plan = planToUse;
            db[userEmail].firstName = firstName;
            db[userEmail].lastName = lastName;
            if (!Array.isArray(db[userEmail].cards)) db[userEmail].cards = [];
            db[userEmail].cards = db[userEmail].cards.map(c => ({...c, isDefault: false}));
            db[userEmail].cards.push(card);
            localStorage.setItem('user-db', JSON.stringify(db));
            localStorage.setItem('user-authenticated', 'true');
            localStorage.setItem('user-plan', planToUse);
            localStorage.setItem('dev-plan', planToUse);
            localStorage.setItem('user-email', userEmail);
          }
          // Simulate processing delay
          setTimeout(function() {
            // Redirect to dashboard
            window.location.href = 'dashboard.html';
          }, 1200);
        });
      }
    });
    
    // INTEGRATION: GOOGLE SHEETS - Functions to manage saved cards could sync with backend/Sheets
    function initializeSavedPaymentMethods() {
      const savedPaymentSection = document.getElementById('savedPaymentSection');
      const savedCardsList = document.getElementById('savedCardsList');
      const addNewCardBtn = document.getElementById('addNewCardBtn');
      const cardForm = document.getElementById('cardForm');
      
      // Check if user has saved cards
      const savedCards = JSON.parse(localStorage.getItem('saved-cards') || '[]');
      
      if (savedCards.length > 0) {
        savedPaymentSection.classList.add('show');
        cardForm.style.display = 'none';
        
        // Display saved cards
        savedCardsList.innerHTML = savedCards.map((card, index) => `
          <div class="saved-card" data-card-index="${index}">
            <div class="saved-card-header">
              <div>
                <div class="saved-card-number">•••• •••• •••• ${card.last4}</div>
                <div class="saved-card-expiry">Expires ${card.expiry}</div>
              </div>
              <div class="saved-card-type">${card.brand}</div>
            </div>
          </div>
        `).join('');
        
        // Handle saved card selection
        savedCardsList.addEventListener('click', (e) => {
          const savedCard = e.target.closest('.saved-card');
          if (savedCard) {
            // Remove selection from all cards
            document.querySelectorAll('.saved-card').forEach(card => {
              card.classList.remove('selected');
            });
            
            // Select clicked card
            savedCard.classList.add('selected');
            
            // TODO: In production, this would use the saved payment method ID
            // For demo, we'll simulate using the saved card
            setTimeout(() => {
              simulateSavedCardPayment(savedCard.dataset.cardIndex);
            }, 500);
          }
        });
      }
      
      // Handle "Add New Card" button
      if (addNewCardBtn) {
        addNewCardBtn.addEventListener('click', () => {
          savedPaymentSection.classList.remove('show');
          cardForm.style.display = 'block';
        });
      }
    }
    
    function simulateSavedCardPayment(cardIndex) {
      const savedCards = JSON.parse(localStorage.getItem('saved-cards') || '[]');
      const selectedCard = savedCards[cardIndex];
      
      if (!selectedCard) return;
      
      // Show processing state
      const container = document.querySelector('.card-container');
      container.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <div style="color: #1976D2; font-size: 2rem; margin-bottom: 1rem;">
            <svg width="40" height="40" viewBox="0 0 50 50">
              <circle cx="25" cy="25" r="20" fill="none" stroke="#1976D2" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)">
                <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
              </circle>
            </svg>
          </div>
          <h2 style="color: #232B36; margin-bottom: 1rem;">Processing Payment...</h2>
          <p style="color: #4B5563;">Using your saved ${selectedCard.brand} card ending in ${selectedCard.last4}</p>
        </div>
      `;
      
      // Simulate payment processing
      setTimeout(() => {
        // TODO: In production, this would call Stripe's confirmCardPayment with the saved payment method
        // For demo, we'll simulate success
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem;">
            <div style="color: #00E676; font-size: 3rem; margin-bottom: 1rem;">✓</div>
            <h2 style="color: #232B36; margin-bottom: 1rem;">Payment Successful!</h2>
            <p style="color: #4B5563;">Your payment with Apple Pay / Google Pay (Demo) was successful. Redirecting to dashboard...</p>
          </div>
        `;
        
        // TODO: In production, send trial expiry reminder email here
        // For demo, we'll just log it
        console.log('TODO: Send trial expiry reminder email to user');
        
        setTimeout(() => {
          window.location.href = 'dashboard.html';
        }, 2000);
      }, 1500);
    }
  </script>
</body>
</html>