<!-- DO NOT EDIT HEADER OR FOOTER PER-PAGE. Use canonical snippet from docs/snippets.md. -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JobHackAI</title>
  <link rel="icon" type="image/png" href="assets/jobhackai_icon_only_128.png">
  <link rel="apple-touch-icon" href="assets/jobhackai_icon_only_128.png">
  <script src="js/dynamic-favicon.js?v=20250111-1"></script>
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <style>
    .dashboard-banner {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(31,41,55,0.07);
      padding: 1.2rem 2rem 1.2rem 2rem;
      margin: 2rem auto 2.2rem auto;
      max-width: 540px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      position: relative;
      align-items: flex-start;
    }
    .dashboard-banner .settings-link {
      position: absolute;
      top: 1.1rem;
      right: 1.2rem;
      color: #6B7280;
      font-size: 1.1rem;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.2rem;
      transition: color 0.18s;
      opacity: 0.7;
    }
    .dashboard-banner .settings-link:hover {
      color: #232B36;
      text-decoration: underline;
      opacity: 1;
    }
    .dashboard-banner .welcome-row {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.08rem;
      margin-bottom: 0.1rem;
    }
    .dashboard-banner .welcome-row h2 {
      font-size: 1.32rem;
      font-weight: 800;
      color: #232B36;
      margin: 0 0 0.08rem 0;
      padding: 0;
    }
    .dashboard-banner .trial-countdown {
      color: #D97706;
      font-weight: 600;
      font-size: 1.01rem;
      margin: 0.05rem 0 0.05rem 0;
      padding: 0;
      line-height: 1.2;
    }
    .dashboard-banner .user-email {
      font-size: 0.98rem;
      color: #6B7280;
      margin-bottom: 0.1rem;
      font-weight: 400;
      letter-spacing: 0.01em;
    }
    .dashboard-banner .plan-badge {
      display: inline-block;
      background: #F3F4F6;
      color: #0077B5;
      font-weight: 700;
      border-radius: 8px;
      padding: 0.18rem 0.7rem;
      font-size: 0.98rem;
      margin-left: 0;
      margin-top: 0.2rem;
    }
    .dashboard-banner .upgrade-btn {
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.5rem;
      font-size: 1.01rem;
      cursor: pointer;
      margin-top: 0.5rem;
      align-self: flex-start;
      transition: background 0.18s;
      text-decoration: none;
      display: inline-block;
    }
    .dashboard-banner .upgrade-btn:hover,
    .dashboard-banner .upgrade-btn:focus {
      background: #00c965;
      text-decoration: none;
      outline: none;
    }
    .dashboard-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
      gap: 1.5rem;
      max-width: 1100px;
      margin: 0 auto 2.5rem auto;
    }
    .feature-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(31,41,55,0.07);
      padding: 1.5rem 1.2rem 1.2rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      align-items: flex-start;
      min-height: 210px;
      position: relative;
    }
    .feature-card.locked {
      opacity: 0.7;
    }
    .feature-card .feature-title {
      font-size: 1.13rem;
      font-weight: 700;
      margin-bottom: 0.2rem;
      color: #232B36;
    }
    .feature-card .feature-desc {
      font-size: 1rem;
      color: #4B5563;
      margin-bottom: 0.7rem;
    }
    .feature-card .feature-action {
      margin-top: auto;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .feature-card .feature-action .btn-primary,
    .feature-card .feature-action a.btn-primary {
      padding: 0.7rem 1.5rem;
    }
    .feature-card .feature-action .btn-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #fff !important;
      color: #1976D2 !important;
      border: 1.5px solid #1976D2;
      font-weight: 600;
      border-radius: 12px;
      font-size: 1.02rem;
      min-width: 160px;
      font-family: 'Inter', Arial, sans-serif;
      text-align: center;
      text-decoration: none;
      transition: background 0.18s, color 0.18s, border-color 0.18s;
      cursor: pointer;
    }
    .feature-card .feature-action .btn-primary:hover,
    .feature-card .feature-action .btn-primary:focus {
      background: #1976D2 !important;
      color: #fff !important;
      border-color: #1976D2;
      text-decoration: none;
      outline: none;
    }
    .feature-card .feature-action .btn-secondary {
      width: 100%;
      min-width: 0;
      font-size: 1.02rem;
      padding: 0.7rem 0;
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
      text-decoration: none;
    }
    .feature-card .feature-action .btn-locked {
      background: #00E676;
      color: #fff;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      cursor: pointer;
      font-weight: 700;
      border-radius: 8px;
      width: 100%;
      font-size: 1.02rem;
      padding: 0.7rem 0;
      transition: background 0.18s;
    }
    .feature-card .feature-action .btn-locked:hover,
    .feature-card .feature-action .btn-locked:focus {
      background: #00c965;
      outline: none;
    }
    .feature-card .included-badge {
      color: #00C853;
      font-size: 0.98rem;
      font-weight: 600;
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .feature-card .included-badge svg {
      vertical-align: middle;
    }
    @media (max-width: 700px) {
      .dashboard-banner, .dashboard-features {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      .dashboard-banner {
        max-width: 98vw;
      }
      .dashboard-features {
        grid-template-columns: 1fr;
      }
    }
    .ats-score-row {
      display: flex;
      align-items: center;
      gap: 1.1rem;
      margin: 0.5rem 0 0.2rem 0;
    }
    .ats-donut {
      width: 54px;
      height: 54px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ats-donut svg {
      width: 54px;
      height: 54px;
      transform: rotate(-90deg);
    }
    .ats-donut .ats-score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.1rem;
      font-weight: 700;
      color: #111;
      text-align: center;
      letter-spacing: 0.5px;
    }
    .ats-score-details {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .ats-score-details .ats-score-label {
      font-size: 1.05rem;
      font-weight: 700;
      color: #232B36;
      margin-bottom: 0.1rem;
    }
    .ats-score-details .ats-score-summary {
      font-size: 1rem;
      color: #4B5563;
      max-width: 340px;
    }
    .user-plan-status {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 1.2rem;
      gap: 0.3rem;
    }
    .user-plan-label {
      font-size: 0.92rem;
      color: #6B7280;
      font-weight: 500;
      margin-bottom: 0.1rem;
      letter-spacing: 0.01em;
    }
    .user-plan-badge {
      font-size: 1.02rem;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.5rem 1.1rem 0.5rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .user-plan-badge.trial {
      color: #FF9100;
      background: #FFF7E6;
    }
    .user-plan-badge.essential {
      color: #0077B5;
      background: #E3F2FD;
    }
    .user-plan-badge.pro {
      color: #388E3C;
      background: #E8F5E9;
    }
    .user-plan-badge.premium {
      color: #C62828;
      background: #FFEBEE;
    }
    .user-plan-icon {
      width: 1.1em;
      height: 1.1em;
      vertical-align: middle;
    }
    .dashboard-banner .upgrade-btn {
      width: 100%;
      margin-top: 0.2rem;
    }
    .dashboard-banner-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 1rem;
      width: 100%;
      margin-top: 1.2rem;
      padding-top: 0.7rem;
      border-top: 1px solid #F3F4F6;
    }
    .user-plan-badge {
      font-size: 1.05rem;
      font-weight: 700;
      border-radius: 999px;
      padding: 0.22rem 1.1rem 0.22rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .user-plan-badge.essential {
      color: #0077B5;
      background: #E3F2FD;
    }
    .user-plan-badge.pro {
      color: #388E3C;
      background: #E8F5E9;
    }
    .user-plan-badge.premium {
      color: #C62828;
      background: #FFEBEE;
    }
    .user-plan-icon {
      width: 1.1em;
      height: 1.1em;
      vertical-align: middle;
    }
    .dashboard-banner-footer .upgrade-btn {
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1.2rem;
      font-size: 1.01rem;
      cursor: pointer;
      transition: background 0.18s;
      text-decoration: none;
      min-width: unset;
      width: auto;
      margin-top: 0;
    }
    .dashboard-banner-footer .upgrade-btn:hover,
    .dashboard-banner-footer .upgrade-btn:focus {
      background: #00c965;
    }
    .status-action-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: flex-end;
      gap: 0.7rem;
      margin-top: 0.5rem;
      width: 100%;
    }
    .user-plan-badge {
      display: flex;
      align-items: center;
      gap: 0.4em;
      background: #FFF7E6;
      color: #FF9100;
      font-weight: 600;
      border-radius: 999px;
      padding: 0.4rem 1.1rem;
      font-size: 1.01rem;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
    }
    .status-action-row .upgrade-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #1976D2;
      color: #fff;
      border: none;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.6rem 1.5rem;
      font-size: 1.02rem;
      min-width: 0;
      box-shadow: 0 1px 4px rgba(31,41,55,0.06);
      transition: background 0.18s, color 0.18s, border-color 0.18s;
      text-decoration: none;
      margin-top: 0;
      width: auto;
    }
    .status-action-row .upgrade-btn:hover,
    .status-action-row .upgrade-btn:focus {
      background: #125bb5;
      color: #fff;
    }
    .jh-tooltip-trigger {
      cursor: pointer;
      margin-left: 0.4em;
      vertical-align: middle;
      position: relative;
      display: inline-block;
    }
    .jh-tooltip-text {
      display: none;
      position: absolute;
      z-index: 1000;
      padding: 0.5rem 0.8rem;
      background-color: #333;
      color: #fff;
      border-radius: 4px;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      min-width: 180px;
      max-width: 260px;
      white-space: normal;
      word-break: break-word;
      font-size: 0.98rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      pointer-events: none;
      text-align: left;
    }
    .jh-tooltip-trigger:hover .jh-tooltip-text,
    .jh-tooltip-trigger:focus .jh-tooltip-text,
    .jh-tooltip-trigger:focus-visible .jh-tooltip-text {
      display: block;
      pointer-events: auto;
    }
    /* Upgrade Pop-up Modal Styles */
    .upgrade-popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .upgrade-popup-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .upgrade-popup-modal {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(31, 41, 55, 0.2);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2rem;
      position: relative;
      transform: scale(0.9) translateY(20px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .upgrade-popup-overlay.show .upgrade-popup-modal {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
    .upgrade-popup-modal .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #6B7280;
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.18s;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    .upgrade-popup-modal .close-btn:hover {
      color: #232B36;
      background: #F3F4F6;
    }
    .upgrade-popup-modal h2 {
      font-size: 1.5rem;
      font-weight: 800;
      color: #232B36;
      margin: 0 0 1rem 0;
      padding-right: 2rem;
    }
    .upgrade-popup-modal .popup-message {
      background: #E6F7FF;
      color: #1976D2;
      padding: 1em 1.2em;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      font-size: 1.01rem;
      line-height: 1.5;
    }
    .upgrade-popup-modal .popup-content {
      color: #4B5563;
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }
    .upgrade-popup-modal .popup-ok-btn {
      background: #00E676;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 2rem;
      font-size: 1.02rem;
      cursor: pointer;
      transition: background 0.18s;
      width: 100%;
      margin-top: 0.5rem;
    }
    .upgrade-popup-modal .popup-ok-btn:hover,
    .upgrade-popup-modal .popup-ok-btn:focus {
      background: #00c965;
      outline: none;
    }
  </style>
</head>
<body>
  <!-- Header (canonical) -->
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="nav-logo" aria-label="Go to homepage">
        <svg width="24" height="24" fill="none" stroke="#1F2937" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        <span>JOBHACKAI</span>
      </a>
      <div class="nav-group">
        <nav class="nav-links" role="navigation">
          <!-- Navigation will be dynamically populated by navigation.js -->
          <a href="index.html#blog">Blog</a>
        </nav>
      </div>
      <button class="mobile-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobileNav">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </header>
  <nav class="mobile-nav" id="mobileNav">
    <!-- Mobile navigation will be dynamically populated by navigation.js -->
  </nav>
  <script>
    // Hamburger menu toggle
    const mobileToggle = document.querySelector('.mobile-toggle');
    const mobileNav = document.getElementById('mobileNav');
    if (mobileToggle && mobileNav) {
      mobileToggle.addEventListener('click', () => {
        const isOpen = mobileNav.classList.toggle('open');
        mobileToggle.setAttribute('aria-expanded', isOpen);
      });
      // Close mobile nav on link click
      document.querySelectorAll('.mobile-nav a').forEach(link => {
        link.addEventListener('click', () => {
          mobileNav.classList.remove('open');
          mobileToggle.setAttribute('aria-expanded', 'false');
        });
      });
    }
  </script>
  <!-- Main Content -->
  <main>
    <div id="dashboard-root"></div>
  </main>
  <!-- Footer (canonical) -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-brand">
        <svg class="footer-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2" stroke="#1F2937" stroke-width="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1F2937" stroke-width="2"/>
        </svg>
        <span class="footer-name">JOBHACKAI</span>
      </div>
      <div class="footer-legal">
        <p>Â© 2026 JobHackAI. All rights reserved.</p>
      </div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="support.html">Support</a>
        <a href="privacy.html">Privacy</a>
      </div>
    </div>
  </footer>
  <script>
    // --- AUTHENTICATION CHECK ---
    function checkAuthentication() {
      const isAuthenticated = localStorage.getItem('user-authenticated') === 'true';
      const mainContent = document.querySelector('main');
      
      if (!isAuthenticated) {
        mainContent.innerHTML = `
          <div style="max-width: 600px; margin: 4rem auto; text-align: center; padding: 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ”’</div>
            <h1 style="font-size: 2rem; font-weight: 700; color: var(--color-text-main); margin-bottom: 1rem;">
              Login Required
            </h1>
            <p style="font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 2rem; line-height: 1.6;">
              You need to be logged in to access your dashboard. 
              Please sign in to view your account and tools.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
              <a href="login.html" class="btn-primary" style="text-decoration: none;">
                Sign In
              </a>
              <a href="pricing-a.html" class="btn-outline" style="text-decoration: none;">
                View Pricing
              </a>
            </div>
          </div>
        `;
        return false;
      }
      return true;
    }

    // --- AUTHENTICATION STATE MANAGEMENT ---
    function getAuthState() {
      // Check for actual authentication (this would integrate with Firebase Auth)
      // For now, we'll use localStorage as a placeholder
      const isAuthenticated = localStorage.getItem('user-authenticated') === 'true';
      const userPlan = localStorage.getItem('user-plan') || 'free';
      
      return {
        isAuthenticated,
        userPlan: isAuthenticated ? userPlan : null
      };
    }

    // --- Initialize on load ---
    document.addEventListener('DOMContentLoaded', function() {
      // Check authentication first
      if (!checkAuthentication()) {
        return; // Stop here if not authenticated
      }
      
      // Get user data from authentication system
      const authState = getAuthState();
      const currentPlan = window.JobHackAINavigation ? window.JobHackAINavigation.getEffectivePlan() : 'free';
      
      // Create user object from authentication data
      const user = {
        name: "User", // This would come from the auth system
        email: "user@example.com", // This would come from the auth system
        plan: currentPlan,
        trialEndsAt: "2024-06-10T00:00:00Z",
        hasUsedFreeTrial: true,
        hasUsedFreeATS: true
      };
      
      // Continue with existing dashboard logic
      renderDashboard(user);
    });

    // --- USER DATA INJECTION (replace with your data source, e.g. from Google Sheets or Wix Data) ---
    // Note: This is now handled in the DOMContentLoaded function above

    // --- FEATURE MATRIX ---
    const featureMatrix = {
      free:     ["ats"],
      trial:    ["ats", "feedback", "interview"],
      essential:["ats", "feedback", "interview"],
      pro:      ["ats", "feedback", "interview", "rewriting", "coverLetter", "mockInterview"],
      premium:  ["ats", "feedback", "interview", "rewriting", "coverLetter", "mockInterview", "linkedin", "priorityReview"]
    };
    // --- FEATURE DEFINITIONS ---
    const features = [
      {
        key: "ats",
        title: "ATS Resume Score",
        desc: "Receive an overall ATS compliance score for your resume, highlighting key areas to improve.",
        action: "Upload PDF",
        included: true
      },
      {
        key: "feedback",
        title: "Resume Feedback",
        desc: "Get a detailed analysis of what's working and what could be improved across every section of your resume.",
        action: "Upgrade to Unlock",
        included: true
      },
      {
        key: "interview",
        title: "Interview Questions",
        desc: "Receive a curated set of practice interview questions tailored to your target role.",
        action: "Start Practice",
        included: true
      },
      {
        key: "rewriting",
        title: "Resume Rewriting",
        desc: "See a rewritten version of your resume tailored to your target job â€“ ready to copy and paste.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "coverLetter",
        title: "Cover Letter Generator",
        desc: "Generate an ATS-optimized, job-specific cover letter in a confident, professional tone.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "mockInterview",
        title: "Mock Interviews",
        desc: "Practice real-time mock interviews with AI feedback to refine your answers and delivery.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "linkedin",
        title: "LinkedIn Optimizer",
        desc: "Optimize your LinkedIn profile section-by-section for maximum recruiter visibility.",
        action: "Upgrade to Unlock",
        included: false
      },
      {
        key: "priorityReview",
        title: "Priority Review",
        desc: "Get your documents reviewed by our AI with expedited turnaround.",
        action: "Upgrade to Unlock",
        included: false
      }
    ];
    // --- RENDER LOGIC ---
    function daysLeft(trialEndsAt) {
      const now = new Date();
      const end = new Date(trialEndsAt);
      const diff = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
      return diff > 0 ? diff : 0;
    }
    // Example ATS score (replace with real value from backend or Google Sheets)
    const atsScore = {
      percent: 78, // 0-100
      value: 78,
      max: 100,
      summary: "Your resume meets many ATS criteria and is likely to be noticed."
    };
    function renderDashboard(user) {
      const root = document.getElementById('dashboard-root');
      const unlocked = featureMatrix[user.plan] || [];
      // ATS Donut SVG (green ring, black text)
      function atsDonut(percent) {
        const radius = 23;
        const stroke = 3;
        const norm = 2 * Math.PI * radius;
        const progress = (percent / 100) * norm;
        return `
          <div class="ats-donut" aria-label="ATS Score">
            <svg viewBox="0 0 54 54">
              <circle cx="27" cy="27" r="${radius}" stroke="#E5E7EB" stroke-width="${stroke}" fill="none"/>
              <circle cx="27" cy="27" r="${radius}" stroke="#00E676" stroke-width="${stroke}" fill="none" stroke-dasharray="${norm}" stroke-dashoffset="${norm - progress}" stroke-linecap="round"/>
            </svg>
            <span class="ats-score-text">${percent}%</span>
          </div>
        `;
      }
      // Banner
      function planIcon(plan) {
        switch (plan) {
          case 'trial':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#FF9100" opacity="0.12"/><path d="M10 4v7l4 2" stroke="#FF9100" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
          case 'essential':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#0077B5" opacity="0.12"/><path d="M10 5v10M5 10h10" stroke="#0077B5" stroke-width="1.5" stroke-linecap="round"/></svg>`;
          case 'pro':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#388E3C" opacity="0.12"/><path d="M6 10l3 3 5-5" stroke="#388E3C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
          case 'premium':
            return `<svg class="user-plan-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="10" fill="#C62828" opacity="0.12"/><path d="M10 5l2.09 4.26L17 9.27l-3.45 3.36L14.18 17 10 14.27 5.82 17l0.63-4.37L3 9.27l4.91-0.01L10 5z" stroke="#C62828" stroke-width="1.2" fill="none"/></svg>`;
          default:
            return '';
        }
      }
      let banner = `<div class="dashboard-banner">
        <a href="#" class="settings-link" aria-label="Account Settings">
          <svg width="20" height="20" fill="none" stroke="#6B7280" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06A1.65 1.65 0 0015 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 008.6 15a1.65 1.65 0 00-1.82-.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.6 8.6a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 008.6 4.6a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0015 4.6a1.65 1.65 0 001.82.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 8.6a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06A1.65 1.65 0 0015 15a1.65 1.65 0 001.82.33z"/></svg>
        </a>
        <div class="welcome-row">
          <h2>Hi, ${user.name || 'User'}</h2>
          ${user.plan === 'trial' ? `<div class="trial-countdown">You have ${daysLeft(user.trialEndsAt)} day${daysLeft(user.trialEndsAt) !== 1 ? 's' : ''} left in your trial!</div>` : ''}
          <div class="user-email">${user.email}</div>
        </div>
        <div class="ats-score-row">
          ${atsDonut(atsScore.percent)}
          <div class="ats-score-details">
            <span class="ats-score-label">${atsScore.percent}%</span>
            <span class="ats-score-summary">${atsScore.summary}</span>
          </div>
        </div>
        <div class="status-action-row">
          <span class="user-plan-badge ${user.plan}">${planIcon(user.plan)}${user.plan.charAt(0).toUpperCase() + user.plan.slice(1)}</span>
          ${(user.plan === 'cancelled') ? `<a href="pricing-a.html" class="upgrade-btn">Reactivate</a>` : ''}
        </div>
      </div>`;
      // Always load last ATS score/result from localStorage if present
      let lastScore = localStorage.getItem('lastATSScore');
      let lastSummary = localStorage.getItem('lastATSSummary');
      if (lastScore && lastSummary) {
        atsScore.value = parseInt(lastScore, 10);
        atsScore.percent = parseInt(lastScore, 10);
        atsScore.summary = lastSummary;
      }
      // Features
      let featuresHtml = '<div class="dashboard-features">';
      // Always render ATS Scoring first
      const atsFeature = features.find(f => f.key === 'ats');
      const otherFeatures = features.filter(f => f.key !== 'ats');
      const orderedFeatures = [atsFeature, ...otherFeatures];
      for (const feature of orderedFeatures) {
        const isUnlocked = unlocked.includes(feature.key);
        featuresHtml += `<div class="feature-card${isUnlocked ? '' : ' locked'}">`;
        featuresHtml += `<div class="feature-title">${feature.title}</div>`;
        featuresHtml += `<div class="feature-desc">${feature.desc}</div>`;
        featuresHtml += `<div class="feature-action">`;
        if (isUnlocked && feature.key === 'ats') {
          // ATS Scoring: real upload
          featuresHtml += `<input type=\"file\" id=\"ats-upload-input\" accept=\"application/pdf\" style=\"display:none;\" />`;
          featuresHtml += `<button class=\"btn-primary\" id=\"ats-upload-btn\">${feature.action}</button>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            usageText = '1 free ATS resume score per month.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade for unlimited ATS scoring and detailed feedback.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = 'Unlimited ATS resume scoring during your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">You have unlimited ATS resume scoring during your trial.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'feedback') {
          // Resume Feedback: link to feedback page
          featuresHtml += `<a href=\"resume-feedback-pro.html\" class=\"btn-primary\">Get Detailed Feedback</a>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            usageText = 'Upgrade to Essential or Pro to unlock detailed feedback.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = '3 feedbacks remaining in your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">You can get up to 3 detailed feedbacks during your trial. Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          } else if (user.plan === 'essential') {
            // For demo, assume 3 left (replace with dynamic count if available)
            usageText = '3 resume feedbacks left this month.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Upgrade to Pro for unlimited feedback.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'interview') {
          // Interview Questions: link to interview questions page
          featuresHtml += `<a href=\"interview-questions.html\" class=\"btn-primary\">${feature.action}</a>`;
          let usageText = '';
          let tooltip = '';
          if (user.plan === 'free') {
            usageText = 'Upgrade to Essential or Pro to unlock interview questions.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Practice as much as you want during your trial.</span>
            </span>`;
          } else if (user.plan === 'trial') {
            usageText = 'Unlimited interview questions during your trial.';
            tooltip = `<span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg>
              <span class="jh-tooltip-text">Practice as much as you want during your trial.</span>
            </span>`;
          }
          featuresHtml += `<div class="usage-indicator">${usageText}${tooltip}</div>`;
        } else if (isUnlocked && feature.key === 'rewriting') {
          // Resume Rewriting: link for Pro and Premium
          featuresHtml += `<a href="resume-feedback-pro.html#rewrite" class="btn-primary">Start Rewriting</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">Unlimited with your Pro plan. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Unlimited with your Pro plan.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'coverLetter') {
          // Cover Letter Generator: link for Pro and Premium
          featuresHtml += `<a href="cover-letter-generator.html" class="btn-primary">Generate Cover Letter</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">Unlimited with your Pro plan. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Unlimited with your Pro plan.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'mockInterview') {
          // Mock Interviews: link for Pro and Premium
          featuresHtml += `<a href="mock-interview.html" class="btn-primary">Start Mock Interview</a>`;
          if (user.plan === 'pro') {
            featuresHtml += `<div class="usage-indicator">20 mock interviews left this month. <span class="jh-tooltip-trigger" tabindex="0" aria-label="More info" style="margin-left:0.4em;vertical-align:middle;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" style="vertical-align:middle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8"/><line x1="12" y1="12" x2="12" y2="16"/></svg><span class="jh-tooltip-text">Upgrade to Premium for unlimited mock interviews.</span></span></div>`;
          }
        } else if (isUnlocked && feature.key === 'linkedin') {
          // LinkedIn Optimizer: link for Premium
          featuresHtml += `<a href=\"linkedin-optimizer.html\" class=\"btn-primary\">Optimize LinkedIn</a>`;
        } else if (isUnlocked && feature.key === 'priorityReview') {
          // Priority Review: icon and text for Premium
          featuresHtml += `<div style=\"display:flex;align-items:center;gap:0.6rem;margin:0.7rem 0 0.2rem 0;\"><svg width=\"22\" height=\"22\" fill=\"none\" stroke=\"#00E676\" stroke-width=\"2\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M12 8v4l2.5 2.5\"/></svg><span style=\"font-weight:600;color:#00C853;\">All your AI-generated content will get priority review.</span></div>`;
        } else {
          featuresHtml += `<button class=\"btn-locked\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"8\" rx=\"2\"/><path d=\"M7 11V7a5 5 0 0110 0v4\"/></svg> ${feature.action}</button>`;
        }
        featuresHtml += `</div>`;
        if (isUnlocked && (user.plan === 'trial' || user.plan === 'essential' || user.plan === 'pro' || user.plan === 'premium')) {
          featuresHtml += `<div class="included-badge"><svg width="16" height="16" fill="#00C853" viewBox="0 0 24 24"><path d="M20.285 6.709a1 1 0 00-1.414-1.418l-9.192 9.192-4.242-4.242a1 1 0 00-1.414 1.414l4.949 4.95a1 1 0 001.414 0l9.899-9.896z"/></svg> Included in ${user.plan === 'trial' ? 'Trial' : user.plan.charAt(0).toUpperCase() + user.plan.slice(1)}</div>`;
        }
        featuresHtml += `</div>`;
      }
      featuresHtml += '</div>';
      root.innerHTML = banner + featuresHtml;
      
      // --- Upgrade Pop-up Logic ---
      function showUpgradePopup() {
        // Check if popup was already shown
        const popupShownKey = 'upgrade-popup-shown';
        if (localStorage.getItem(popupShownKey) === 'true') {
          return;
        }
        
        // Check if user upgraded from free to trial/subscription
        const hasUpgradedPlan = user.plan === 'trial' || user.plan === 'essential' || user.plan === 'pro' || user.plan === 'premium';
        if (!hasUpgradedPlan) {
          return;
        }
        
        // Check if user had uploaded a resume for free ATS scoring
        // Check multiple indicators that user had a free account with resume upload
        const hasATSScoreHistory = localStorage.getItem('lastATSScore') || localStorage.getItem('lastATSSummary');
        const hasUsedFreeATS = localStorage.getItem('hasUsedFreeATS') === 'true';
        const hasFreeUsageData = localStorage.getItem('free-ats-usage');
        const hasUploadedResume = localStorage.getItem('lastUploadedResume') || localStorage.getItem('hasUploadedResume') === 'true';
        
        // Try to get user UID from Firebase Auth Manager
        const currentUser = window.FirebaseAuthManager?.getCurrentUser?.();
        const creditKey = currentUser?.uid ? `creditsByUid:${currentUser.uid}` : null;
        let hasUsedFreeCredit = false;
        if (creditKey) {
          const creditsData = localStorage.getItem(creditKey);
          if (creditsData) {
            try {
              const credits = JSON.parse(creditsData);
              hasUsedFreeCredit = credits.ats_free_lifetime === 0;
            } catch (e) {
              // Ignore parse errors
            }
          }
        }
        
        // Only show popup if user had uploaded a resume for free ATS scoring
        const hadResumeUpload = hasATSScoreHistory || hasUsedFreeATS || hasFreeUsageData || hasUploadedResume || hasUsedFreeCredit;
        if (!hadResumeUpload) {
          return;
        }
        
        // Create and show popup
        const popupHTML = `
          <div class="upgrade-popup-overlay" id="upgrade-popup-overlay">
            <div class="upgrade-popup-modal">
              <button class="close-btn" id="upgrade-popup-close" aria-label="Close">Ã—</button>
              <h2>Hi, ${user.name || 'User'}</h2>
              <div class="popup-message">
                Your previous ATS resume score has been carried over from your free account. You now have access to more features and unlimited scoring!
              </div>
              <div class="popup-content">
                <p>You can now upload unlimited resumes for ATS scoring and access additional features like detailed resume feedback and interview question generation.</p>
              </div>
              <button class="popup-ok-btn" id="upgrade-popup-ok">OK</button>
            </div>
          </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', popupHTML);
        const overlay = document.getElementById('upgrade-popup-overlay');
        const closeBtn = document.getElementById('upgrade-popup-close');
        const okBtn = document.getElementById('upgrade-popup-ok');
        
        // Escape key handler - stored so it can be removed later
        const escapeKeyHandler = function(e) {
          if (e.key === 'Escape' && overlay.classList.contains('show')) {
            closePopup();
          }
        };
        
        function closePopup() {
          overlay.classList.remove('show');
          // Remove Escape key listener to prevent memory leak
          document.removeEventListener('keydown', escapeKeyHandler);
          setTimeout(() => {
            overlay.remove();
            localStorage.setItem(popupShownKey, 'true');
          }, 300);
        }
        
        // Show popup with fade-in animation
        setTimeout(() => {
          overlay.classList.add('show');
        }, 100);
        
        // Close handlers
        closeBtn.addEventListener('click', closePopup);
        okBtn.addEventListener('click', closePopup);
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) {
            closePopup();
          }
        });
        
        // Close on Escape key
        document.addEventListener('keydown', escapeKeyHandler);
      }
      
      // Show popup after a short delay to ensure page is rendered
      setTimeout(() => {
        showUpgradePopup();
      }, 500);
      
      // --- ATS Upload Button Logic ---
      const atsUploadBtn = document.getElementById('ats-upload-btn');
      const atsUploadInput = document.getElementById('ats-upload-input');
      if (atsUploadBtn && atsUploadInput) {
        atsUploadBtn.addEventListener('click', async function() {
          const currentUser = window.FirebaseAuthManager?.getCurrentUser?.();
          if (!currentUser) {
            alert('Please log in to use ATS scoring');
            return;
          }
          
          // Fetch current plan and check if user has unlimited access
          try {
            const idToken = await currentUser.getIdToken();
            const planRes = await fetch('/api/plan/me', {
              headers: { Authorization: `Bearer ${idToken}` }
            });
            const planData = await planRes.json();
            const plan = planData.plan || localStorage.getItem('user-plan') || 'free';
            
            // Trial and subscription plans have unlimited ATS scoring - skip credit check
            const hasUnlimitedAccess = plan === 'trial' || plan === 'essential' || plan === 'pro' || plan === 'premium';
            
            // Only check credits for free users - do NOT show alert for trial/paid users
            if (!hasUnlimitedAccess && plan === 'free') {
              const creditKey = `creditsByUid:${currentUser.uid}`;
              const creditsData = localStorage.getItem(creditKey);
              let credits = { ats_free_lifetime: 0 };
              if (creditsData) {
                try {
                  credits = JSON.parse(creditsData);
                } catch (e) {
                  // Ignore parse errors, use default credits
                  console.warn('Failed to parse credits data:', e);
                }
              }
              
              if (credits.ats_free_lifetime <= 0) {
                alert('You have used your free ATS score. Upgrade to unlock unlimited scoring!');
                window.location.href = 'pricing-a.html';
                return;
              }
            }
            
            // Trigger file input
            atsUploadInput.click();
          } catch (error) {
            console.error('Error checking plan:', error);
            // Fallback: trigger file input anyway
            atsUploadInput.click();
          }
        });
        
        atsUploadInput.addEventListener('change', async function(e) {
          const file = e.target.files[0];
          if (!file) return;
          
          // Check free account usage limits - skip for trial/subscription users
          const currentUser = window.FirebaseAuthManager?.getCurrentUser?.();
          let userPlan = user.plan || localStorage.getItem('user-plan') || 'free';
          
          // Try to get fresh plan data from API first
          if (currentUser) {
            try {
              const idToken = await currentUser.getIdToken();
              const planRes = await fetch('/api/plan/me', {
                headers: { Authorization: `Bearer ${idToken}` }
              });
              if (planRes.ok) {
                const planData = await planRes.json();
                userPlan = planData.plan || userPlan;
                // Update localStorage to keep it in sync
                if (planData.plan) {
                  localStorage.setItem('user-plan', planData.plan);
                }
              }
            } catch (error) {
              console.error('Error fetching plan:', error);
            }
          }
          
          // Also check billing-status API as fallback for trial users
          if (userPlan === 'free' && currentUser) {
            try {
              const idToken = await currentUser.getIdToken();
              const billingRes = await fetch('/api/billing-status', {
                headers: { Authorization: `Bearer ${idToken}` }
              });
              if (billingRes.ok) {
                const billingData = await billingRes.json();
                if (billingData.plan && billingData.plan !== 'free') {
                  userPlan = billingData.plan;
                  localStorage.setItem('user-plan', billingData.plan);
                  console.log('âœ… Updated plan from billing-status:', billingData.plan);
                }
              }
            } catch (error) {
              console.warn('Error fetching billing status:', error);
            }
          }
          
          const hasUnlimitedAccess = userPlan === 'trial' || userPlan === 'essential' || userPlan === 'pro' || userPlan === 'premium';
          
          // Early return for trial/paid users - they have unlimited access
          if (hasUnlimitedAccess) {
            console.log('âœ… Trial/paid user detected, allowing unlimited resume uploads. Plan:', userPlan);
            // Continue to upload processing below
          } else if (userPlan === 'free' && window.freeAccountManager) {
            // Only check free account limits for free users
            const usageCheck = window.freeAccountManager.canUseATSScoring();
            if (!usageCheck.allowed) {
              // Show upgrade modal
              const upgradeMsg = window.freeAccountManager.getUpgradeMessage();
              if (upgradeMsg) {
                alert(`${upgradeMsg.title}\n\n${upgradeMsg.message}`);
                // Redirect to pricing
                window.location.href = 'pricing-a.html';
                return;
              }
            }
          }
          
          // Store last uploaded resume in localStorage for use on Resume Feedback page
          const reader = new FileReader();
          reader.onload = function(evt) {
            // Store as base64 string (for demo; in production, use backend or secure storage)
            localStorage.setItem('lastUploadedResume', evt.target.result);
            // Optionally, store file name
            localStorage.setItem('lastUploadedResumeName', file.name);
            // Mark that user has uploaded a resume (for upgrade popup detection)
            localStorage.setItem('hasUploadedResume', 'true');
          };
          reader.readAsDataURL(file);
          
          // Simulate ATS scoring and update donut/summary
          const score = Math.floor(Math.random() * 31) + 60; // 60-90%
          const summary = score > 85 ? 'Excellent! Your resume is highly ATS compatible.' : score > 70 ? 'Your resume meets many ATS criteria and is likely to be noticed.' : 'Your resume needs improvement for better ATS results.';
          
          // Store score for upgrade popup detection
          localStorage.setItem('lastATSScore', score.toString());
          localStorage.setItem('lastATSSummary', summary);
          
          // Update donut
          const donut = document.querySelector('.ats-donut');
          if (donut) {
            const radius = 23;
            const norm = 2 * Math.PI * radius;
            const progress = (score / 100) * norm;
            const svg = donut.querySelector('svg');
            if (svg) {
              const circles = svg.querySelectorAll('circle');
              if (circles[1]) circles[1].setAttribute('stroke-dashoffset', (norm - progress));
            }
            const text = donut.querySelector('.ats-score-text');
            if (text) text.textContent = score + '%';
          }
          // Update score label and summary
          const scoreLabel = document.querySelector('.ats-score-label');
          if (scoreLabel) scoreLabel.textContent = score + '%';
          const scoreSummary = document.querySelector('.ats-score-summary');
          if (scoreSummary) scoreSummary.textContent = summary;
        });
      }
      // NOTE: Resume Feedback page should read the last uploaded resume from localStorage (key: 'lastUploadedResume') if present.
    }
  </script>
  <!-- Load navigation system -->
  <script src="js/navigation.js?v=20251007-1"></script>
  <script>
    if (window.JobHackAINavigation && typeof window.JobHackAINavigation.initializeNavigation === 'function') {
      window.JobHackAINavigation.initializeNavigation();
    } else {
      window.addEventListener('DOMContentLoaded', function() {
        if (window.JobHackAINavigation && typeof window.JobHackAINavigation.initializeNavigation === 'function') {
          window.JobHackAINavigation.initializeNavigation();
        }
      });
    }
  </script>
  <script src="js/main.js" type="module"></script>
  <script src="js/analytics.js" type="module"></script>
</body>
</html> 