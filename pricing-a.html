<!-- DO NOT EDIT HEADER OR FOOTER PER-PAGE. Use canonical snippet from docs/snippets.md. -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JobHackAI</title>
  <link rel="icon" type="image/png" href="assets/jobhackai_icon_only_128.png">
  <link rel="apple-touch-icon" href="assets/jobhackai_icon_only_128.png">
  <script src="js/dynamic-favicon.js?v=20250111-1"></script>

  <!-- Design tokens & global styles -->
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/main.css">

  <!-- Component overrides -->
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="css/pricing.css">
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="nav-logo" aria-label="Go to homepage">
        <svg width="24" height="24" fill="none" stroke="#1F2937" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        <span>JOBHACKAI</span>
      </a>
      <div class="nav-group">
        <nav class="nav-links" role="navigation">
          <!-- Navigation will be dynamically populated by navigation.js -->
        </nav>
      </div>
      <button class="mobile-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobileNav">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </header>
  <nav class="mobile-nav" id="mobileNav">
    <!-- Mobile navigation will be dynamically populated by navigation.js -->
  </nav>
  <div class="mobile-nav-backdrop" id="mobileNavBackdrop"></div>
  <!-- Centralized mobile menu handler -->
  <script src="js/mobile-menu.js?v=20250115-1"></script>
  <!-- page content -->
  <main>
    <section class="pricing-section">
      <div class="pricing-table-wrapper">
        <h1 class="pricing-title">Choose the Plan That Matches Your Ambition</h1>
        <table class="pricing-table" role="table" aria-label="JobHackAI Pricing Plans">
          <thead>
            <tr>
              <th>Feature</th>
              <th>Create Account</th>
              <th>3-Day Trial</th>
              <th>Essential<br><span class="plan-price">$29/mo</span></th>
              <th>Pro<br><span class="plan-price">$59/mo</span></th>
              <th>Premium<br><span class="plan-price">$99/mo</span></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ATS Resume Scoring</td>
              <td class="yes">
                <svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg>
              </td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Resume Feedback</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Resume Rewriting</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Cover Letter Generator</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Interview Questions</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Mock Interviews</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>LinkedIn Optimizer</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr>
              <td>Priority Review</td>
              <td class="no"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#FF0000" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="lock"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-label="Locked" role="img" title="Locked"><rect x="5" y="10" width="14" height="10" rx="2"/><path d="M8 10V8a4 4 0 0 1 8 0v2"/><circle cx="12" cy="15" r="1.75"/></svg></td>
              <td class="yes"><svg class="pricing-icon" viewBox="0 0 24 24" fill="none" stroke="#1F2937" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4.5 12.5l5 5L19.5 7.5"/></svg></td>
            </tr>
            <tr class="pricing-signup-row">
              <td></td>
              <td><button class="btn-primary stripe-checkout-btn" data-plan="free" data-amount="0">Create Free Account</button></td>
              <td><button class="btn-primary stripe-checkout-btn" data-plan="trial" data-amount="0">Start Free Trial</button></td>
              <td><button class="btn-primary stripe-checkout-btn" data-plan="essential" data-amount="2900">Get Essential Plan</button></td>
              <td><button class="btn-primary stripe-checkout-btn" data-plan="pro" data-amount="5900">Get Pro Plan</button></td>
              <td><button class="btn-primary stripe-checkout-btn" data-plan="premium" data-amount="9900">Get Premium Plan</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-brand">
        <svg class="footer-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="2" stroke="#1F2937" stroke-width="2"/>
          <path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1F2937" stroke-width="2"/>
        </svg>
        <span class="footer-name">JOBHACKAI</span>
      </div>
      <div class="footer-legal">
        <p>Â© 2025 JobHackAI. All rights reserved.</p>
      </div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="help.html">Help</a>
        <a href="privacy.html">Privacy</a>
      </div>
    </div>
  </footer>
  <!-- Load Firebase auth modules -->
  <script src="js/firebase-config.js" type="module"></script>
  <script src="js/firebase-auth.js?v=20251011-1" type="module"></script>
  <!-- Load navigation system -->
  <script src="js/navigation.js?v=20251011-1"></script>
  <script src="js/universal-logout.js?v=20251007-2"></script>
  <!-- Load Stripe integration -->
  <script src="js/stripe-integration.js"></script>
  <!-- scripts -->
  <script src="js/main.js" type="module"></script>
  <script src="js/analytics.js" type="module"></script>
  <script>
    // Initialize pricing page Stripe functionality
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize navigation system
      if (window.JobHackAINavigation && window.JobHackAINavigation.initializeNavigation) {
        window.JobHackAINavigation.initializeNavigation();
      }
      
      const checkoutButtons = document.querySelectorAll('.stripe-checkout-btn');
      
      // Check if user is already authenticated (compute at click-time for freshness)
      const getAuthState = () => {
        // SECURITY: Get email from Firebase auth instead of localStorage
        const user = window.FirebaseAuthManager?.getCurrentUser?.();
        return {
          isAuthenticated: localStorage.getItem('user-authenticated') === 'true' && !!user,
          userEmail: user?.email || null,
          currentPlan: localStorage.getItem('user-plan') || 'free'
        };
      };
      
      checkoutButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          e.preventDefault();
          const plan = button.dataset.plan;
          const amount = parseInt(button.dataset.amount);
          
          // Add loading state
          const originalText = button.textContent;
          button.disabled = true;
          button.style.opacity = '0.7';
          button.style.cursor = 'wait';
          
          if (plan === 'free') {
            // Store normalized plan selection in sessionStorage
            function selectPlan(planId, planName, price) {
              const selectedPlanPayload = {
                planId,
                planName,
                price,
                source: "pricing-page",
                timestamp: Date.now()
              };
              sessionStorage.setItem("selectedPlan", JSON.stringify(selectedPlanPayload));
              try { localStorage.setItem("selectedPlan", JSON.stringify(selectedPlanPayload)); } catch (_) {}
              window.location.href = "/login.html?plan=" + encodeURIComponent(planId);
            }
            selectPlan('free', 'Free Plan', '$0/mo');
            return;
          }
          
          // If user is authenticated, handle upgrade directly
          const { isAuthenticated, userEmail, currentPlan } = getAuthState();
          if (isAuthenticated && userEmail) {
            button.textContent = originalText;
            button.disabled = false;
            button.style.opacity = '1';
            button.style.cursor = 'pointer';
            // Authenticated path â†’ server checkout (using SECURE endpoints)
            (async () => {
              try {
                console.log('ðŸ”¥ Starting checkout for plan:', plan);
                
                // Wait for Firebase to be ready
                const user = await window.FirebaseAuthManager?.waitForAuthReady?.() || window.FirebaseAuthManager?.currentUser;
                console.log('ðŸ”¥ User after waitForAuthReady:', user ? `User: ${user.email}` : 'null');
                
                if (!user) {
                  throw new Error('Not authenticated');
                }
                
                // Force refresh token to ensure it's valid
                const idToken = await user.getIdToken(true);
                console.log('ðŸ”¥ ID Token obtained:', idToken ? `${idToken.substring(0, 20)}...` : 'null');
                
                if (!idToken) {
                  throw new Error('Could not get ID token');
                }
                
                const res = await fetch('/api/stripe-checkout', {
                  method: 'POST',
                  headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${idToken}`
                  },
                  body: JSON.stringify({ 
                    plan, 
                    startTrial: plan === 'trial' 
                  })
                });
                
                console.log('ðŸ”¥ Stripe checkout response status:', res.status);
                const data = await res.json();
                console.log('ðŸ”¥ Stripe checkout response data:', data);
                
                if (data && data.ok && data.url) { 
                  console.log('ðŸ”¥ Redirecting to Stripe:', data.url);
                  window.location.href = data.url; 
                  return; 
                }
                throw new Error(data?.error || 'Checkout failed');
              } catch (e) {
                console.error('Checkout error:', e);
                const errorMessage = e?.message || 'Checkout failed';
                console.error('Full checkout error details:', {
                  message: errorMessage,
                  stack: e?.stack,
                  response: e?.response
                });
                // Provide more helpful error message
                if (errorMessage.includes('unauthorized') || errorMessage.includes('token')) {
                  alert('Your session has expired. Please log in again and try upgrading.');
                } else if (errorMessage.includes('Trial already used')) {
                  alert('You have already used your free trial. Please select a paid plan.');
                } else {
                  alert(`Unable to start checkout: ${errorMessage}. Please try again or contact support.`);
                }
                button.textContent = originalText;
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
              }
            })();
          } else {
            // New user - store normalized plan selection in sessionStorage
            function selectPlan(planId, planName, price) {
              const selectedPlanPayload = {
                planId,
                planName,
                price,
                source: "pricing-page",
                timestamp: Date.now()
              };
              sessionStorage.setItem("selectedPlan", JSON.stringify(selectedPlanPayload));
              try { localStorage.setItem("selectedPlan", JSON.stringify(selectedPlanPayload)); } catch (_) {}
              window.location.href = "/login.html?plan=" + encodeURIComponent(planId);
            }
            const planMap = {
              trial: { planId: 'trial', planName: '3-Day Trial', price: '$0' },
              essential: { planId: 'essential', planName: 'Essential Plan', price: '$29/mo' },
              pro: { planId: 'pro', planName: 'Pro Plan', price: '$59/mo' },
              premium: { planId: 'premium', planName: 'Premium Plan', price: '$99/mo' }
            };
            const payload = planMap[plan] || { planId: plan, planName: 'Selected Plan', price: '' };
            selectPlan(payload.planId, payload.planName, payload.price);
          }
        });
      });
      
      // Update button text for authenticated users
      const { isAuthenticated: _isAuthInit, currentPlan: _initPlan } = getAuthState();
      if (_isAuthInit) {
        updateButtonsForAuthenticatedUser(_initPlan);
      }
    });
    
    function userHasCard(userEmail) {
      const db = JSON.parse(localStorage.getItem('user-db') || '{}');
      if (!db[userEmail]) return false;
      return Array.isArray(db[userEmail].cards) && db[userEmail].cards.length > 0;
    }
    
    function handleAuthenticatedUserUpgrade(newPlan, amount, currentPlan) {
      // Don't allow downgrading to same or lower plan
      const planHierarchy = ['free', 'trial', 'essential', 'pro', 'premium'];
      const currentIndex = planHierarchy.indexOf(currentPlan);
      const newIndex = planHierarchy.indexOf(newPlan);
      
      if (newIndex <= currentIndex) {
        showUpgradeErrorModal(currentPlan, newPlan);
        return;
      }
      
      // Directly start server Checkout (Stripe handles payment methods)
      (async () => {
        try {
          const idToken = await window.FirebaseAuthManager?.getCurrentUser?.()?.getIdToken?.();
          const res = await fetch('/api/stripe-checkout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}) },
            body: JSON.stringify({ plan: newPlan, startTrial: newPlan === 'trial' })
          });
          const data = await res.json();
          if (data && data.ok && data.url) { window.location.href = data.url; return; }
          throw new Error(data?.error || 'Checkout failed');
        } catch (e) {
          console.error('Checkout error:', e);
          alert('Unable to start checkout. Please try again.');
        }
      })();
    }
    
    function showUpgradeConfirmationModal(newPlan, currentPlan, amount) {
      const planNames = {
        'trial': '3-Day Free Trial',
        'essential': 'Essential Plan',
        'pro': 'Pro Plan',
        'premium': 'Premium Plan'
      };
      
      const planPrices = {
        'trial': '$0 for 3 days',
        'essential': '$29/month',
        'pro': '$59/month',
        'premium': '$99/month'
      };
      
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s ease-out;
      `;
      
      modal.innerHTML = `
        <style>
          @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
          @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        </style>
        <div style="
          background: white;
          border-radius: 16px;
          padding: 2rem;
          max-width: 450px;
          margin: 1rem;
          box-shadow: 0 20px 25px -5px rgba(0,0,0,0.15);
          animation: slideUp 0.3s ease-out;
        ">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #00E676 0%, #00c965 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                <path d="M5 12l5 5L20 7"/>
              </svg>
            </div>
            <h3 style="margin: 0 0 0.5rem 0; color: #232B36; font-size: 1.5rem; font-weight: 700;">Upgrade Your Plan</h3>
            <p style="margin: 0; color: #64748B; font-size: 1rem;">You're about to upgrade to a better plan</p>
          </div>
          
          <div style="background: #F8FAFC; border-radius: 12px; padding: 1.25rem; margin-bottom: 1.5rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid #E2E8F0;">
              <span style="color: #64748B; font-size: 0.95rem;">Current Plan:</span>
              <span style="color: #232B36; font-weight: 600;">${currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: #64748B; font-size: 0.95rem;">New Plan:</span>
              <div style="text-align: right;">
                <div style="color: #00E676; font-weight: 700; font-size: 1.1rem;">${planNames[newPlan]}</div>
                <div style="color: #232B36; font-size: 0.9rem;">${planPrices[newPlan]}</div>
              </div>
            </div>
          </div>
          
          <div style="background: #FFF7ED; border: 1px solid #FED7AA; border-radius: 8px; padding: 0.875rem; margin-bottom: 1.5rem;">
            <p style="margin: 0; color: #9A3412; font-size: 0.9rem; line-height: 1.5;">
              <strong>Note:</strong> Your new plan will start immediately and you'll be charged ${planPrices[newPlan]} starting today.
            </p>
          </div>
          
          <div style="display: flex; gap: 0.75rem;">
            <button id="cancelUpgrade" style="
              flex: 1;
              background: white;
              color: #64748B;
              border: 1px solid #CBD5E1;
              padding: 0.875rem;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
              font-size: 1rem;
              transition: all 0.2s;
            " onmouseover="this.style.background='#F8FAFC'" onmouseout="this.style.background='white'">
              Cancel
            </button>
            <button id="confirmUpgrade" style="
              flex: 1;
              background: #00E676;
              color: white;
              border: none;
              padding: 0.875rem;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 700;
              font-size: 1rem;
              transition: all 0.2s;
            " onmouseover="this.style.background='#00c965'" onmouseout="this.style.background='#00E676'">
              Confirm Upgrade
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Handle cancel
      modal.querySelector('#cancelUpgrade').addEventListener('click', () => {
        modal.remove();
      });
      
      // Handle confirm
      modal.querySelector('#confirmUpgrade').addEventListener('click', () => {
        modal.remove();
        processUpgrade(newPlan, currentPlan);
      });
      
      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }
    
    function showUpgradeErrorModal(currentPlan, newPlan) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      `;
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 16px;
          padding: 2rem;
          max-width: 400px;
          margin: 1rem;
          text-align: center;
          box-shadow: 0 20px 25px -5px rgba(0,0,0,0.15);
        ">
          <div style="width: 60px; height: 60px; background: #FEF2F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="12"/>
              <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
          </div>
          <h3 style="margin: 0 0 0.75rem 0; color: #232B36; font-size: 1.3rem; font-weight: 700;">Already on This Plan</h3>
          <p style="margin: 0 0 1.5rem 0; color: #64748B; line-height: 1.6;">
            You're currently on the <strong>${currentPlan}</strong> plan. Please select a higher tier to upgrade your account.
          </p>
          <button onclick="this.closest('div').parentElement.remove()" style="
            width: 100%;
            background: #00E676;
            color: white;
            border: none;
            padding: 0.875rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
          ">
            Got it
          </button>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }
    
    function processUpgrade(newPlan, currentPlan) {
      // SECURITY: Get email from Firebase auth instead of localStorage
      const user = window.FirebaseAuthManager?.getCurrentUser?.();
      const userEmail = user?.email || null;
      if (true) {
        // INTEGRATION: STRIPE - Handle subscription upgrade here
        // For demo, just update the user's plan
        const getUserDB = () => {
          try {
            return JSON.parse(localStorage.getItem('user-db') || '{}');
          } catch (error) {
            console.error('Error loading user database:', error);
            return {};
          }
        };
        
        const setUserDB = (db) => {
          try {
            localStorage.setItem('user-db', JSON.stringify(db));
            localStorage.setItem('user-db-backup', JSON.stringify(db));
          } catch (error) {
            console.error('Error saving user database:', error);
          }
        };
        
        const db = getUserDB();
        if (db[userEmail]) {
          // Only update the plan property, preserve all other user data (including cards)
          db[userEmail].plan = newPlan;
          db[userEmail].lastUpgrade = new Date().toISOString();
          setUserDB(db);
          
          // Update local storage
          localStorage.setItem('user-plan', newPlan);
          localStorage.setItem('dev-plan', newPlan);
          localStorage.removeItem('selected-plan');
          localStorage.removeItem('plan-amount');
          
          // Sync with navigation system
          if (window.JobHackAINavigation) {
            window.JobHackAINavigation.setAuthState(true, newPlan);
          }
          
          // Show success modal
          showUpgradeSuccessModal(newPlan);
        } else {
          alert('Error: User data not found. Please try logging in again.');
          window.location.href = 'login.html';
        }
      }
    }
    
    function updateButtonsForAuthenticatedUser(currentPlan) {
      const buttons = document.querySelectorAll('.stripe-checkout-btn');
      const planNames = {
        'trial': '3-Day Free Trial',
        'essential': 'Essential Plan',
        'pro': 'Pro Plan',
        'premium': 'Premium Plan'
      };
      
      buttons.forEach(button => {
        const plan = button.dataset.plan;
        if (plan === 'free') {
          if (currentPlan === 'free') {
            button.textContent = 'Current Plan';
            button.disabled = true;
            button.style.opacity = '0.6';
            button.style.cursor = 'not-allowed';
          } else {
            // For non-free plans, show Dashboard button
            const isAuthenticated = localStorage.getItem('user-authenticated') === 'true';
            if (isAuthenticated) {
              button.textContent = 'Dashboard';
              button.onclick = () => window.location.href = 'dashboard.html';
            } else {
              button.textContent = 'Get Started';
              button.onclick = () => window.location.href = 'login.html';
            }
          }
        } else if (plan === 'trial') {
          if (currentPlan === 'free') {
            // Free account users should see "Start Free Trial" not "Current Plan"
            button.textContent = 'Start Free Trial';
          } else if (currentPlan === 'trial') {
            button.textContent = 'Current Plan';
            button.disabled = true;
            button.style.opacity = '0.6';
            button.style.cursor = 'not-allowed';
          } else {
            button.textContent = `Upgrade to ${planNames[plan]}`;
          }
        } else if (plan === currentPlan) {
          button.textContent = `Current Plan`;
          button.disabled = true;
          button.style.opacity = '0.6';
          button.style.cursor = 'not-allowed';
        } else {
          button.textContent = `Upgrade to ${planNames[plan]}`;
        }
      });
    }
    
    function showUpgradeSuccessModal(newPlan) {
      const planNames = {
        'trial': '3-Day Free Trial',
        'essential': 'Essential Plan',
        'pro': 'Pro Plan',
        'premium': 'Premium Plan'
      };
      
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s ease-out;
      `;
      
      modal.innerHTML = `
        <style>
          @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
          @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
          @keyframes checkmark {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
          }
        </style>
        <div style="
          background: white;
          border-radius: 20px;
          padding: 3rem 2rem;
          max-width: 400px;
          margin: 1rem;
          text-align: center;
          box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
          animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        ">
          <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #00E676 0%, #00c965 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; box-shadow: 0 10px 25px rgba(0, 230, 118, 0.3);">
            <svg width="40" height="40" viewBox="0 0 52 52" style="stroke-dasharray: 100; stroke-dashoffset: 0; animation: checkmark 0.6s cubic-bezier(0.65, 0, 0.45, 1) 0.2s forwards;">
              <circle cx="26" cy="26" r="25" fill="none" stroke="white" stroke-width="3" opacity="0.3"/>
              <path fill="none" stroke="white" stroke-width="4" stroke-linecap="round" d="M14 27l8 8 16-16" style="stroke-dasharray: 50; stroke-dashoffset: 50; animation: checkmark 0.5s ease-out 0.3s forwards;"/>
            </svg>
          </div>
          <h2 style="margin: 0 0 0.75rem 0; color: #232B36; font-size: 1.75rem; font-weight: 800;">Upgrade Successful!</h2>
          <p style="margin: 0 0 0.5rem 0; color: #64748B; font-size: 1.1rem; line-height: 1.6;">
            You're now on the <strong style="color: #00E676;">${planNames[newPlan]}</strong>
          </p>
          <p style="margin: 0 0 2rem 0; color: #94A3B8; font-size: 0.95rem;">
            Redirecting you to your dashboard...
          </p>
          <div style="width: 40px; height: 4px; background: linear-gradient(90deg, #00E676 0%, #00c965 100%); border-radius: 2px; margin: 0 auto; animation: progressBar 1.5s ease-out;"></div>
        </div>
        <style>
          @keyframes progressBar {
            from { width: 0%; }
            to { width: 100%; }
          }
        </style>
      `;
      
      document.body.appendChild(modal);
      
      // Redirect after animation
      setTimeout(() => {
        window.location.href = 'billing-management.html';
      }, 2000);
    }
    
    // Removed add-card modal; Stripe Portal handles payment methods
  </script>
  
</body>
</html>
