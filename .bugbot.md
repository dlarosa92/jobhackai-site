---
bugbot:
  name: "JobHackAI QA Rules"
  version: "1.0.0"
  description: "Ensures build, auth, KV, and Stripe consistency across Cloudflare + Next.js hybrid stack"
  severity_levels:
    critical: "Critical"
    major: "Major"
    info: "Info"
  auto_merge: false
  branches: ["dev0", "develop", "main"]
  watch_paths:
    - app/
    - functions/
    - js/
    - css/
    - assets/
  ignore_paths:
    - docs/
    - marketing/
    - wix/
    - tests/
    - archive/

---

# JobHackAI Bugbot Rules

Bugbot monitors commits and PRs to enforce build stability, deployment consistency, and authentication integrity across the JobHackAI stack.

## ‚öôÔ∏è Build Integrity

1. Next.js must export static pages.
   - Verify `output: 'export'` is present in `app/next.config.js`.
2. Postbuild should copy static assets into `/out/`.
   - Expect copies of `../*.html`, `../css/`, `../js/`, and `../assets/` into `/out/`.

## üîê Authentication & Guards

1. All protected HTML pages must include the head-first static auth guard.
   - Verify `<script src="js/static-auth-guard.js">` is referenced in `<head>`.
   - Protected pages include:
     - `dashboard.html`
     - `account-setting.html`
     - `billing-management.html`
     - `resume-feedback-pro.html`
     - `mock-interview.html`
     - `linkedin-optimizer.html`
     - `interview-questions.html`
     - `cover-letter-generator.html`

## üí≥ Stripe & Billing Logic

1. Webhook compliance (`functions/api/stripe-webhook.js`):
   - Must continue to handle `customer.subscription.updated` events.
   - Must maintain signature verification via `verifyStripeWebhook`.

## ‚òÅÔ∏è Cloudflare Environment Rules

1. Never remove or rename required environment variables:
   - `ENVIRONMENT`
   - `FRONTEND_URL`
   - `STRIPE_SECRET_KEY`
   - `STRIPE_PUBLISHABLE_KEY`
   - `JOBHACKAI_KV`
2. Validate that `/functions/` folder exports valid handlers after edits.
3. Warn if PR modifies Cloudflare KV bindings in Wrangler configs.

---

## üß™ Automated Checks

```yaml
checks:
  - name: "Build output is static export"
    match: "app/next.config.js"
    ensure_contains: "output: 'export'"
    severity: critical

  - name: "Auth guard inclusion (Dashboard)"
    match: "dashboard.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: critical

  - name: "Auth guard inclusion (Account Settings)"
    match: "account-setting.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: critical

  - name: "Auth guard inclusion (Billing Management)"
    match: "billing-management.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Auth guard inclusion (Resume Feedback Pro)"
    match: "resume-feedback-pro.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Auth guard inclusion (Mock Interview)"
    match: "mock-interview.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Auth guard inclusion (LinkedIn Optimizer)"
    match: "linkedin-optimizer.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Auth guard inclusion (Interview Questions)"
    match: "interview-questions.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Auth guard inclusion (Cover Letter Generator)"
    match: "cover-letter-generator.html"
    ensure_contains: "<script src=\"js/static-auth-guard.js\">"
    severity: major

  - name: "Stripe webhook handlers present"
    match: "functions/api/stripe-webhook.js"
    ensure_contains:
      - "customer.subscription.updated"
      - "verifyStripeWebhook"
    severity: critical

  - name: "Functions export handler present (middleware)"
    match: "functions/_middleware.js"
    ensure_contains: "export async function onRequest"
    severity: major

  - name: "KV binding present in Wrangler config (local)"
    match: "app/wrangler.local.toml"
    ensure_contains: "JOBHACKAI_KV"
    severity: major

  - name: "KV binding present in Wrangler config (root, if used)"
    match: "wrangler.toml"
    ensure_contains: "JOBHACKAI_KV"
    severity: info

  - name: "Environment variables present (.env files)"
    match: ".env.*"
    ensure_contains:
      - "ENVIRONMENT="
      - "FRONTEND_URL="
      - "STRIPE_SECRET_KEY="
      - "STRIPE_PUBLISHABLE_KEY="
    severity: major
```

---

